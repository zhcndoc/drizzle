import CodeTab from "@mdx/CodeTab.astro";
import CodeTabs from "@mdx/CodeTabs.astro";
import Section from "@mdx/Section.astro";
import Tab from "@mdx/Tab.astro";
import Tabs from "@mdx/Tabs.astro";
import Callout from "@mdx/Callout.astro";
import Prerequisites from "@mdx/Prerequisites.astro"
import Npx from "@mdx/Npx.astro";
import SchemaFilePaths from "@mdx/SchemaFilePaths.mdx"
import Dialects from "@mdx/Dialects.mdx"

# `drizzle-kit generate`

<Prerequisites>
- å¼€å§‹ä½¿ç”¨ Drizzle å’Œ `drizzle-kit` - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/get-started)
- Drizzle æ¨¡å¼åŸºç¡€ - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/sql-schema-declaration)
- æ•°æ®åº“è¿æ¥åŸºç¡€ - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/connect-overview)
- Drizzle è¿ç§»åŸºç¡€ - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/migrations)
- Drizzle Kit [æ¦‚è¿°](/docs/kit-overview) å’Œ [é…ç½®æ–‡ä»¶](/docs/drizzle-config-file)
</Prerequisites>


<br/>

`drizzle-kit generate` å…è®¸æ‚¨æ ¹æ®r Drizzle æ¨¡å¼åœ¨å£°æ˜æ—¶æˆ–åç»­æ¨¡å¼æ›´æ”¹æ—¶ç”Ÿæˆ SQL è¿ç§»ã€‚
<Callout collapsed="å®ƒæ˜¯å¦‚ä½•åœ¨åå°å·¥ä½œçš„ï¼Ÿ">
Drizzle Kit `generate` å‘½ä»¤è§¦å‘ä»¥ä¸‹äº‹ä»¶åºåˆ—ï¼š
1. å®ƒå°†è¯»å–æ‚¨çš„ Drizzle æ¨¡å¼æ–‡ä»¶å¹¶åˆ›å»ºæ¨¡å¼çš„ JSON å¿«ç…§
2. å®ƒå°†è¯»å–æ‚¨å…ˆå‰çš„è¿ç§»æ–‡ä»¶å¤¹å¹¶å°†å½“å‰ JSON å¿«ç…§ä¸æœ€æ–°çš„å¿«ç…§è¿›è¡Œæ¯”è¾ƒ
3. åŸºäº JSON å·®å¼‚ï¼Œå®ƒå°†ç”Ÿæˆ SQL è¿ç§»
4. ä¿å­˜ `migration.sql` å’Œ `snapshot.json` åœ¨ä»¥å½“å‰æ—¶é—´æˆ³å‘½åçš„è¿ç§»æ–‡ä»¶å¤¹ä¸­

<Section>
```typescript filename="src/schema.ts"
import * as p from "./drizzle-orm/pg-core";

export const users = p.pgTable("users", {
  id: p.serial().primaryKey(),
  name: p.text(),
  email: p.text().unique(), 
};
```
```                                  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  
â”‚ $ drizzle-kit generate â”‚                  
â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  
  â”‚                                           
  â”” 1. è¯»å–å…ˆå‰çš„è¿ç§»æ–‡ä»¶å¤¹
    2. æ‰¾åˆ°å½“å‰å’Œå…ˆå‰æ¨¡å¼ä¹‹é—´çš„å·®å¼‚
    3. å¦‚æœéœ€è¦ï¼Œæç¤ºå¼€å‘è€…é‡å‘½å
  â”Œ 4. ç”Ÿæˆ SQL è¿ç§»å¹¶æŒä¹…åŒ–åˆ°æ–‡ä»¶
  â”‚    â”Œâ”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  
  â”‚      ğŸ“‚ drizzle       
  â”‚      â”œ ğŸ“‚ _meta
  â”‚      â”” ğŸ“œ 0000_premium_mister_fear.sql
  v
```
```sql
-- drizzle/0000_premium_mister_fear.sql

CREATE TABLE "users" (
 "id" SERIAL PRIMARY KEY,
 "name" TEXT,
 "email" TEXT UNIQUE
);
```
</Section>
</Callout>

å®ƒæ—¨åœ¨è¦†ç›– [ä»£ç ä¼˜å…ˆ](/docs/migrations) çš„ Drizzle è¿ç§»ç®¡ç†æ–¹æ³•ã€‚
æ‚¨å¯ä»¥ä½¿ç”¨ [`drizzle-kit migrate`](/docs/drizzle-kit-migrate) åº”ç”¨ç”Ÿæˆçš„è¿ç§»ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ drizzle-orm çš„ `migrate()`ï¼Œ
ä½¿ç”¨å¤–éƒ¨è¿ç§»å·¥å…·ï¼Œå¦‚ [bytebase](https://www.bytebase.com/)ï¼Œæˆ–è€…ç›´æ¥åœ¨æ•°æ®åº“ä¸Šæ‰§è¡Œè¿ç§»ã€‚

`drizzle-kit generate` å‘½ä»¤è¦æ±‚æ‚¨æä¾› `dialect` å’Œ `schema` è·¯å¾„é€‰é¡¹ï¼Œ
æ‚¨å¯ä»¥é€šè¿‡ [drizzle.config.ts](/docs/drizzle-config-file) é…ç½®æ–‡ä»¶æˆ–é€šè¿‡ CLI é€‰é¡¹è®¾ç½®å®ƒä»¬ã€‚
<CodeTabs items={["ä½¿ç”¨é…ç½®æ–‡ä»¶", "ä½œä¸º CLI é€‰é¡¹"]}>
<Section>
```ts
// drizzle.config.ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
});
```
```shell
npx drizzle-kit generate
```
</Section>

```shell
npx drizzle-kit generate --dialect=postgresql --schema=./src/schema.ts
```
</CodeTabs>

### æ¨¡å¼æ–‡ä»¶è·¯å¾„
æ‚¨å¯ä»¥æœ‰ä¸€ä¸ªå•ç‹¬çš„ `schema.ts` æ–‡ä»¶ï¼Œæˆ–è€…åœ¨é¡¹ç›®ä¸­æ‹¥æœ‰ä»»æ„æ•°é‡çš„æ¨¡å¼æ–‡ä»¶ã€‚
Drizzle Kit è¦æ±‚æ‚¨é€šè¿‡ `schema` é…ç½®é€‰é¡¹ä»¥ [glob](https://www.digitalocean.com/community/tools/glob?comments=true&glob=/**/*.js&matches=false&tests=//%20This%20will%20match%20as%20it%20ends%20with%20'.js'&tests=/hello/world.js&tests=//%20This%20won't%20match!&tests=/test/some/globs) æŒ‡å®šè·¯å¾„ã€‚

<SchemaFilePaths/>


### è‡ªå®šä¹‰è¿ç§»æ–‡ä»¶å
æ‚¨å¯ä»¥é€šè¿‡æä¾› `--name` CLI é€‰é¡¹è®¾ç½®è‡ªå®šä¹‰è¿ç§»æ–‡ä»¶åã€‚
```shell
npx drizzle-kit generate --name=init
```
```plaintext {4}
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ ğŸ“‚ drizzle
 â”‚ â”œ ğŸ“‚ _meta
 â”‚ â”” ğŸ“œ 0000_init.sql 
 â”œ ğŸ“‚ src
 â”” â€¦
```

### é¡¹ç›®ä¸­çš„å¤šä¸ªé…ç½®æ–‡ä»¶
æ‚¨å¯ä»¥åœ¨é¡¹ç›®ä¸­æ‹¥æœ‰å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œè¿™åœ¨æ‚¨æœ‰å¤šä¸ªæ•°æ®åº“é˜¶æ®µã€å¤šä¸ªæ•°æ®åº“æˆ–è€…åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸Šæœ‰ä¸åŒæ•°æ®åº“æ—¶éå¸¸æœ‰ç”¨ï¼š
<Npx>
  drizzle-kit generate --config=drizzle-dev.config.ts
  drizzle-kit generate --config=drizzle-prod.config.ts
</Npx>
```plaintext {5-6}
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”œ ğŸ“œ .env
 â”œ ğŸ“œ drizzle-dev.config.ts
 â”œ ğŸ“œ drizzle-prod.config.ts
 â”œ ğŸ“œ package.json
 â”” ğŸ“œ tsconfig.json
```

### è‡ªå®šä¹‰è¿ç§»
æ‚¨å¯ä»¥ç”Ÿæˆç©ºçš„è¿ç§»æ–‡ä»¶ä»¥ç¼–å†™è‡ªå·±çš„è‡ªå®šä¹‰ SQL è¿ç§»
ç”¨äºå½“å‰ä¸è¢« Drizzle Kit æ”¯æŒçš„ DDL æ›´æ”¹æˆ–æ•°æ®å¡«å……ã€‚æœ‰å…³è‡ªå®šä¹‰è¿ç§»çš„æ‰©å±•æ–‡æ¡£ - [ç‚¹å‡»è¿™é‡Œ](/docs/kit-custom-migrations)

```shell
drizzle-kit generate --custom --name=seed-users
```
<Section>
```plaintext {5}
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ ğŸ“‚ drizzle
 â”‚ â”œ ğŸ“‚ _meta
 â”‚ â”œ ğŸ“œ 0000_init.sql 
 â”‚ â”” ğŸ“œ 0001_seed-users.sql 
 â”œ ğŸ“‚ src
 â”” â€¦
```
```sql
-- ./drizzle/0001_seed-users.sql

INSERT INTO "users" ("name") VALUES('Dan');
INSERT INTO "users" ("name") VALUES('Andrew');
INSERT INTO "users" ("name") VALUES('Dandrew');
```
</Section>

### å¯ç”¨é…ç½®çš„æ‰©å±•åˆ—è¡¨
`drizzle-kit generate` æœ‰ä¸€ç³»åˆ—ä»…é™ cli çš„é€‰é¡¹ã€‚

<rem025/>

|               |                                                      |
| :--------     | :--------------------------------------------------- |
| `custom`      | ç”Ÿæˆè‡ªå®šä¹‰è¿ç§»çš„ç©º SQL æ–‡ä»¶                     |
| `name`        | ç”Ÿæˆè‡ªå®šä¹‰åç§°çš„è¿ç§»                             |

<rem025/>

<Npx>
drizzle-kit generate --name=init
drizzle-kit generate --name=seed_users --custom
</Npx>

<br/>
<hr/>
<br/>
æˆ‘ä»¬æ¨èé€šè¿‡ [drizzle.config.ts](/docs/drizzle-config-file) æ–‡ä»¶æ¥é…ç½® `drizzle-kit`ï¼Œ
ä½†å¦‚æœæœ‰å¿…è¦ï¼Œæ‚¨ä¹Ÿå¯ä»¥é€šè¿‡ CLI æä¾›æ‰€æœ‰é…ç½®é€‰é¡¹ï¼Œä¾‹å¦‚åœ¨ CI/CD ç®¡é“ç­‰ä¸­ã€‚

|               |            |                                                                            |
| :------------ | :-------   | :----------------------------------------------------------------------    |
| `dialect`     | `required` | æ•°æ®åº“æ–¹è¨€ï¼Œå–å€¼ä¹‹ä¸€ <Dialects/>                                       |
| `schema`      | `required` | æŒ‡å‘ TypeScript æ¨¡å¼æ–‡ä»¶æˆ–åŒ…å«å¤šä¸ªæ¨¡å¼æ–‡ä»¶çš„æ–‡ä»¶å¤¹çš„è·¯å¾„             |
| `out`         |            | è¿ç§»è¾“å‡ºæ–‡ä»¶å¤¹ï¼Œé»˜è®¤ä¸º `./drizzle`                                       |
| `config`      |            | é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤ä¸º `drizzle.config.ts`                                  |
| `breakpoints` |            | SQL è¯­å¥æ–­ç‚¹ï¼Œé»˜è®¤å€¼ä¸º `true`                                            |


### æ‰©å±•ç¤ºä¾‹
å¦‚ä½•åˆ›å»ºä¸€ä¸ªåä¸º `0001_seed-users.sql` çš„è‡ªå®šä¹‰ PostgreSQL è¿ç§»æ–‡ä»¶çš„ç¤ºä¾‹ã€‚
Drizzle æ¨¡å¼ä½äº `./src/schema.ts`ï¼Œè¿ç§»æ–‡ä»¶å¤¹åä¸º `./migrations`ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ `./drizzle`ã€‚

æˆ‘ä»¬è¿˜å°†åœ¨ `configs` æ–‡ä»¶å¤¹ä¸­æ”¾ç½® drizzle é…ç½®æ–‡ä»¶ã€‚

è®©æˆ‘ä»¬åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š

```plaintext {4}
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ ğŸ“‚ migrations
 â”œ ğŸ“‚ configs
 â”‚ â”” ğŸ“œ drizzle.config.ts
 â”œ ğŸ“‚ src
 â”” â€¦
```
```ts filename='drizzle.config.ts'
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  out: "./migrations",
});
```

ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œï¼š
```shell
npx drizzle-kit generate --config=./configs/drizzle.config.ts --name=seed-users --custom
```
å®ƒå°†æˆåŠŸç”Ÿæˆï¼š
<Section>
```plaintext {6}
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ â€¦
 â”œ ğŸ“‚ migrations
 â”‚ â”œ ğŸ“‚ _meta
 â”‚ â”œ ğŸ“œ 0000_init.sql 
 â”‚ â”” ğŸ“œ 0001_seed-users.sql 
 â”” â€¦
```
```sql
-- ./drizzle/0001_seed-users.sql

INSERT INTO "users" ("name") VALUES('Dan');
INSERT INTO "users" ("name") VALUES('Andrew');
INSERT INTO "users" ("name") VALUES('Dandrew');
```
</Section>
