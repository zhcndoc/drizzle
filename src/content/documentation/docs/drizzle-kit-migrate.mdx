import CodeTab from "@/components/markdown/CodeTab.astro";
import CodeTabs from "@/components/markdown/CodeTabs.astro";
import Section from "@/components/markdown/Section.astro";
import Tab from "@/components/markdown/Tab.astro";
import Tabs from "@/components/markdown/Tabs.astro";
import Callout from "@mdx/Callout.astro";
import Prerequisites from "@mdx/Prerequisites.astro";
import Npx from "@mdx/Npx.astro";

# `drizzle-kit migrate`
<Prerequisites>
- å¼€å§‹ä½¿ç”¨ Drizzle å’Œ `drizzle-kit` - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/get-started)
- Drizzle æ¨¡å¼åŸºç¡€ - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/sql-schema-declaration)
- æ•°æ®åº“è¿æ¥åŸºç¡€ - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/connect-overview)
- Drizzle è¿ç§»åŸºç¡€ - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/migrations)
- Drizzle Kit [æ¦‚è¿°](/docs/kit-overview) å’Œ [é…ç½®æ–‡ä»¶](/docs/drizzle-config-file)
- `drizzle-kit generate` å‘½ä»¤ - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/drizzle-kit-generate)
</Prerequisites>
<br/>


`drizzle-kit migrate` å…è®¸æ‚¨åº”ç”¨ç”± [`drizzle-kit generate`](/docs/drizzle-kit-generate) ç”Ÿæˆçš„ SQL è¿ç§»ã€‚
å®ƒè®¾è®¡ç”¨äºæ”¯æŒç®¡ç† Drizzle è¿ç§»çš„ [ä»£ç ä¼˜å…ˆï¼ˆé€‰é¡¹ 3ï¼‰](/docs/migrations) æ–¹æ³•ã€‚

<Callout collapsed="å®ƒæ˜¯å¦‚ä½•åœ¨åå°å·¥ä½œçš„ï¼Ÿ">
Drizzle Kit `migrate` å‘½ä»¤è§¦å‘ä¸€ç³»åˆ—äº‹ä»¶ï¼š
1. è¯»å–è¿ç§»æ–‡ä»¶å¤¹å¹¶è¯»å–æ‰€æœ‰ `.sql` è¿ç§»æ–‡ä»¶
2. è¿æ¥åˆ°æ•°æ®åº“å¹¶ä» drizzle è¿ç§»æ—¥å¿—è¡¨ä¸­è·å–æ¡ç›®
3. æ ¹æ®ä¹‹å‰åº”ç”¨çš„è¿ç§»å†³å®šè¦è¿è¡Œå“ªäº›æ–°è¿ç§»
4. è¿è¡Œ SQL è¿ç§»å¹¶å°†å·²åº”ç”¨çš„è¿ç§»è®°å½•åˆ° drizzle è¿ç§»è¡¨

<Section>
```plaintext
  â”œ ğŸ“‚ drizzle       
  â”‚ â”œ ğŸ“‚ _meta
  â”‚ â”œ ğŸ“œ 0000_premium_mister_fear.sql
  â”‚ â”” ğŸ“œ 0001_delicate_professor_xavie.sql
  â”” â€¦
```
```plaintext
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  
â”‚ $ drizzle-kit migrate â”‚                  
â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  
  â”‚                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         
  â”” 1. è¯»å–è¿ç§».sql æ–‡ä»¶åœ¨è¿ç§»æ–‡ä»¶å¤¹ä¸­       â”‚                          â”‚
    2. ä»æ•°æ®åº“è·å–è¿ç§»å†å² -------------> â”‚                          â”‚
  â”Œ 3. é€‰æ‹©ä¹‹å‰æœªåº”ç”¨çš„è¿ç§» <-------------- â”‚         æ•°æ®åº“         â”‚
  â”” 4. å°†æ–°è¿ç§»åº”ç”¨åˆ°æ•°æ®åº“ ---------------> â”‚                          â”‚
                                                            â”‚                          â”‚
                                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
[âœ“] å®Œæˆ!        
```
</Section>
</Callout>

`drizzle-kit migrate` å‘½ä»¤è¦æ±‚æ‚¨æŒ‡å®š `dialect` å’Œæ•°æ®åº“è¿æ¥å‡­æ®ï¼Œ
æ‚¨å¯ä»¥é€šè¿‡ [drizzle.config.ts](/docs/drizzle-config-file) é…ç½®æ–‡ä»¶æˆ– CLI é€‰é¡¹æä¾›è¿™äº›ä¿¡æ¯ã€‚

<CodeTabs items={["ä½¿ç”¨é…ç½®æ–‡ä»¶", "ä½œä¸º CLI é€‰é¡¹"]}>
<Section>
```ts {5,8}
// drizzle.config.ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  dbCredentials: {
    url: "postgresql://user:password@host:port/dbname"
  },
});
```
```shell
npx drizzle-kit migrate
```
</Section>
```shell
npx drizzle-kit migrate --dialect=postgresql --url=postgresql://user:password@host:port/dbname
```
</CodeTabs>

### æ•°æ®åº“ä¸­çš„å·²åº”ç”¨è¿ç§»æ—¥å¿—
åœ¨è¿è¡Œè¿ç§»åï¼ŒDrizzle Kit å°†åœ¨æ‚¨çš„æ•°æ®åº“ä¸­æŒä¹…åŒ–å…³äºæˆåŠŸåº”ç”¨è¿ç§»çš„è®°å½•ã€‚
å®ƒå°†æŠŠè¿™äº›è®°å½•å­˜å‚¨åœ¨åä¸º `__drizzle_migrations` çš„è¿ç§»æ—¥å¿—è¡¨ä¸­ã€‚

æ‚¨å¯ä»¥é€šè¿‡ drizzle é…ç½®æ–‡ä»¶è‡ªå®šä¹‰è¯¥è¡¨çš„ **è¡¨** å’Œ **æ¨¡å¼**ï¼ˆä»…ç”¨äº PostgreSQLï¼‰ï¼š
```ts filename="drizzle.config.ts" {8-9}
export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  dbCredentials: {
    url: "postgresql://user:password@host:port/dbname"
  },
  migrations: {
    table: 'my-migrations-table', // é»˜è®¤æ˜¯ `__drizzle_migrations`
    schema: 'public', // ä»…åœ¨ PostgreSQL ä¸­ä½¿ç”¨ï¼Œé»˜è®¤æ˜¯ `drizzle`
  },
});
```

### ä¸€ä¸ªé¡¹ç›®ä¸­çš„å¤šä¸ªé…ç½®æ–‡ä»¶
æ‚¨å¯ä»¥åœ¨é¡¹ç›®ä¸­æ‹¥æœ‰å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œå½“æ‚¨æœ‰å¤šä¸ªæ•°æ®åº“é˜¶æ®µæˆ–åœ¨åŒä¸€é¡¹ç›®ä¸­æœ‰å¤šä¸ªæ•°æ®åº“æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ï¼š
<Npx>
  drizzle-kit migrate --config=drizzle-dev.config.ts
  drizzle-kit migrate --config=drizzle-prod.config.ts
</Npx>
```plaintext {5-6}
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”œ ğŸ“œ .env
 â”œ ğŸ“œ drizzle-dev.config.ts
 â”œ ğŸ“œ drizzle-prod.config.ts
 â”œ ğŸ“œ package.json
 â”” ğŸ“œ tsconfig.json
```

### æ‰©å±•ç¤ºä¾‹
è®©æˆ‘ä»¬ç”Ÿæˆ SQL è¿ç§»å¹¶ä½¿ç”¨ `drizzle-kit generate` å’Œ `drizzle-kit migrate` å‘½ä»¤å°†å…¶åº”ç”¨åˆ°æˆ‘ä»¬çš„æ•°æ®åº“ã€‚

```plaintext
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”‚ â”œ ğŸ“œ schema.ts
 â”‚ â”” ğŸ“œ index.ts
 â”œ ğŸ“œ drizzle.config.ts
 â”” â€¦
```
<CodeTabs items={["drizzle.config.ts", "src/schema.ts"]}>
```ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  dbCredentials: {
    url: "postgresql://user:password@host:port/dbname"
  },
  migrations: {
    table: 'journal', 
    schema: 'drizzle', 
  },
});
```
```ts 
import * as p from "drizzle-orm/pg-core";

export const users = p.pgTable("users", {
  id: p.serial().primaryKey(),
  name: p.text(),
})
```
</CodeTabs>

ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œ
```shell
npx drizzle-kit generate --name=init
```
å®ƒå°†ç”Ÿæˆ
<Section>
```plaintext {5}
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ â€¦
 â”œ ğŸ“‚ migrations
 â”‚ â”œ ğŸ“‚ _meta
 â”‚ â”” ğŸ“œ 0000_init.sql 
 â”” â€¦
```
```sql
-- ./drizzle/0000_init.sql

CREATE TABLE "users"(
  id serial primary key,
  name text,
)
```
</Section>

ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œ
```shell
npx drizzle-kit migrate
```

æˆ‘ä»¬çš„ SQL è¿ç§»ç°åœ¨å·²æˆåŠŸåº”ç”¨åˆ°æ•°æ®åº“ âœ…
