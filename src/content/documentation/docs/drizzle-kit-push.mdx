import CodeTab from "@/components/markdown/CodeTab.astro";
import CodeTabs from "@/components/markdown/CodeTabs.astro";
import Section from "@/components/markdown/Section.astro";
import Tab from "@/components/markdown/Tab.astro";
import Tabs from "@/components/markdown/Tabs.astro";
import Callout from "@/components/markdown/Callout.astro";
import Prerequisites from "@mdx/Prerequisites.astro";
import Npx from "@mdx/Npx.astro";
import SchemaFilePaths from "@mdx/SchemaFilePaths.mdx";
import Drivers from "@mdx/Drivers.mdx"
import Dialects from "@mdx/Dialects.mdx"
import DriversExamples from "@mdx/DriversExamples.mdx"

# `drizzle-kit push`

<Prerequisites>
  - ä» Drizzle å’Œ `drizzle-kit` å¼€å§‹ - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/get-started)
  - Drizzle æ¨¡å¼åŸºç¡€ - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/sql-schema-declaration) 
  - æ•°æ®åº“è¿æ¥åŸºç¡€ - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/connect-overview) 
  - Drizzle è¿ç§»åŸºç¡€ - [ç‚¹å‡»è¿™é‡Œé˜…è¯»](/docs/migrations) 
  - Drizzle Kit [æ¦‚è¿°](/docs/kit-overview) å’Œ [é…ç½®æ–‡ä»¶](/docs/drizzle-config-file) æ–‡æ¡£
</Prerequisites>


`drizzle-kit push` å…è®¸ä½ ç›´æ¥å°†ä½ çš„æ¨¡å¼åŠåç»­çš„æ¨¡å¼å˜åŒ–æ¨é€åˆ°æ•°æ®åº“ï¼Œ
åŒæ—¶çœç•¥ SQL æ–‡ä»¶çš„ç”Ÿæˆï¼Œ
æ—¨åœ¨è¦†ç›– Drizzle è¿ç§»çš„ [ä»£ç ä¼˜å…ˆ](/docs/migrations) æ–¹æ³•ã€‚

<Callout collapsed="å®ƒæ˜¯å¦‚ä½•åœ¨å†…éƒ¨å·¥ä½œçš„ï¼Ÿ">
å½“ä½ è¿è¡Œ Drizzle Kit çš„ `push` å‘½ä»¤æ—¶ï¼Œå®ƒä¼šï¼š
1. è¯»å–ä½ çš„ Drizzle æ¨¡å¼æ–‡ä»¶å¹¶ç»„æˆä¸€ä¸ª JSON å¿«ç…§
2. æ‹‰å–ï¼ˆå†…çœï¼‰æ•°æ®åº“æ¨¡å¼ 
3. æ ¹æ®è¿™ä¸¤è€…ä¹‹é—´çš„å·®å¼‚ç”Ÿæˆ SQL è¿ç§»
4. å°† SQL è¿ç§»åº”ç”¨åˆ°æ•°æ®åº“

<Section>
```typescript filename="src/schema.ts"
import * as p from "drizzle-orm/pg-core";

export const users = p.pgTable("users", {
  id: p.serial().primaryKey(),
  name: p.text(),
};
```
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  
â”‚ ~ drizzle-kit push  â”‚                  
â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  
  â”‚                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”” Pull current datatabase schema ---------> â”‚                          â”‚
                                              â”‚                          â”‚
  â”Œ Generate alternations based on diff <---- â”‚         DATABASE         â”‚
  â”‚                                           â”‚                          â”‚
  â”” Apply migrations to the database -------> â”‚                          â”‚
                                       â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   create table users(id serial primary key, name text);
```
</Section>
</Callout>

è¿™æ˜¯å¿«é€ŸåŸå‹è®¾è®¡çš„æœ€ä½³æ–¹æ³•ï¼Œ
æˆ‘ä»¬å·²ç»çœ‹åˆ°æ•°åä¸ªå›¢é˜Ÿå’Œç‹¬ç«‹å¼€å‘è€…æˆåŠŸåœ°å°†å…¶ä½œä¸ºä»–ä»¬ç”Ÿäº§åº”ç”¨ä¸­çš„ä¸»è¦è¿ç§»æµç¨‹ã€‚
å®ƒä¸è“ç»¿éƒ¨ç½²ç­–ç•¥å’Œæ— æœåŠ¡å™¨æ•°æ®åº“å¦‚
[Planetscale](https://planetscale.com/)ã€[Neon](https://neon.tech/)ã€[Turso](https://turso.tech/drizzle) ç­‰éå¸¸å¥‘åˆã€‚

<br/>
<hr/>
<br/>


`drizzle-kit push` éœ€è¦ä½ æŒ‡å®š `dialect`ã€æ¨¡å¼æ–‡ä»¶çš„è·¯å¾„ï¼Œ
å¹¶æä¾›æ•°æ®åº“è¿æ¥çš„ `url` æˆ– `user:password@host:port/db` å‚æ•°ï¼Œ
ä½ å¯ä»¥é€šè¿‡ [drizzle.config.ts](/docs/drizzle-config-file) é…ç½®æ–‡ä»¶æˆ– CLI é€‰é¡¹æä¾›å®ƒä»¬ï¼š

<CodeTabs items={["ä½¿ç”¨é…ç½®æ–‡ä»¶", "ä½¿ç”¨ CLI é€‰é¡¹"]}>
<Section>
```ts
// drizzle.config.ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  dbCredentials: {
    url: "postgresql://user:password@host:port/dbname",
  },
});
```
```shell
npx drizzle-kit push
```
</Section>

```shell
npx drizzle-kit push --dialect=postgresql --schema=./src/schema.ts --url=postgresql://user:password@host:port/dbname
```

</CodeTabs>

### æ¨¡å¼æ–‡ä»¶è·¯å¾„

ä½ å¯ä»¥æœ‰ä¸€ä¸ªå•ç‹¬çš„ `schema.ts` æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦åœ¨é¡¹ç›®ä¸­åˆ†æ•£å¤šä¸ªæ¨¡å¼æ–‡ä»¶ã€‚
Drizzle Kit è¦æ±‚ä½ é€šè¿‡ `schema` é…ç½®é€‰é¡¹ä½œä¸º [glob](https://www.digitalocean.com/community/tools/glob?comments=true&glob=/**/*.js&matches=false&tests=//%20This%20will%20match%20as%20it%20ends%20with%20'.js'&tests=/hello/world.js&tests=//%20This%20won't%20match!&tests=/test/some/globs) æŒ‡å®šå®ƒä»¬çš„è·¯å¾„ã€‚

<SchemaFilePaths />

### é¡¹ç›®ä¸­å¤šä¸ªé…ç½®æ–‡ä»¶

ä½ å¯ä»¥åœ¨é¡¹ç›®ä¸­æœ‰å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œå½“ä½ æœ‰å¤šä¸ªæ•°æ®åº“é˜¶æ®µã€å¤šä¸ªæ•°æ®åº“æˆ–åŒä¸€é¡¹ç›®ä¸­çš„ä¸åŒæ•°æ®åº“æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ï¼š

<Npx>
  drizzle-kit push --config=drizzle-dev.config.ts
  drizzle-kit push --config=drizzle-prod.config.ts
</Npx>
```plaintext {5-6}
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”œ ğŸ“œ .env
 â”œ ğŸ“œ drizzle-dev.config.ts
 â”œ ğŸ“œ drizzle-prod.config.ts
 â”œ ğŸ“œ package.json
 â”” ğŸ“œ tsconfig.json
```

### æŒ‡å®šæ•°æ®åº“é©±åŠ¨
<Callout type="warning">
**Expo SQLite** å’Œ **OP SQLite** æ˜¯è®¾å¤‡ä¸Šçš„ï¼ˆæ¯ç”¨æˆ·ï¼‰æ•°æ®åº“ï¼Œæ— æ³•åœ¨å…¶ä¸­ `push` è¿ç§»ã€‚<br/>
å¯¹äºåµŒå…¥å¼æ•°æ®åº“ï¼ŒDrizzle æä¾›äº† **åµŒå…¥å¼è¿ç§»** - æŸ¥çœ‹æˆ‘ä»¬çš„ [å¿«é€Ÿå¼€å§‹](/docs/get-started/expo-new) æŒ‡å—ã€‚
</Callout>
Drizzle Kit ä¸åŒ…å«é¢„æ‰“åŒ…çš„æ•°æ®åº“é©±åŠ¨ï¼Œ
å®ƒå°†æ ¹æ®å½“å‰é¡¹ç›®çš„ `dialect` è‡ªåŠ¨é€‰æ‹©å¯ç”¨çš„æ•°æ®åº“é©±åŠ¨ - [æŸ¥çœ‹è®¨è®º](https://github.com/drizzle-team/drizzle-orm/discussions/2203)ã€‚

å¤§å¤šæ•°åŒä¸€æ–¹è¨€çš„é©±åŠ¨ç¨‹åºå…±äº«ç›¸åŒçš„è¿æ¥å‚æ•°ï¼Œ
è‡³äºåƒ `aws-data-api`ã€`pglight` å’Œ `d1-http` çš„ä¾‹å¤–æƒ…å†µï¼Œä½ å°†éœ€è¦æ˜¾å¼æŒ‡å®š `driver` å‚æ•°ã€‚

<DriversExamples/>

### åŒ…æ‹¬è¡¨ã€æ¨¡å¼å’Œæ‰©å±•
`drizzle-kit push` é»˜è®¤ç®¡ç† `public` æ¨¡å¼ä¸­çš„æ‰€æœ‰è¡¨ã€‚
ä½ å¯ä»¥é€šè¿‡ `tablesFilters`ã€`schemaFilter` å’Œ `extensionFilters` é€‰é¡¹é…ç½®è¡¨ã€æ¨¡å¼å’Œæ‰©å±•çš„åˆ—è¡¨ã€‚

|                     |                                                                                               |
| :------------------ | :-------------------------------------------------------------------------------------------- |
| `tablesFilter`      | åŸºäº `glob` çš„è¡¨åè¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ `["users", "user_info"]` æˆ– `"user*" `ã€‚é»˜è®¤æ˜¯ `"*"` |
| `schemaFilter`      | æ¨¡å¼åè¿‡æ»¤å™¨ï¼Œä¾‹å¦‚ `["public", "drizzle"]`ã€‚é»˜è®¤æ˜¯ `["public"]`                    |
| `extensionsFilters` | å·²å®‰è£…æ•°æ®åº“æ‰©å±•çš„åˆ—è¡¨ï¼Œä¾‹å¦‚ `["postgis"]`ã€‚é»˜è®¤æ˜¯ `[]`                    |
<br/>

è®©æˆ‘ä»¬é…ç½® drizzle-kit åªæ“ä½œ **public** æ¨¡å¼ä¸­çš„ **æ‰€æœ‰è¡¨**ï¼Œ
å¹¶è®© drizzle-kit çŸ¥é“æœ‰ä¸€ä¸ªå®‰è£…çš„ **postgis** æ‰©å±•ï¼Œ
å®ƒä¼šåœ¨ public æ¨¡å¼ä¸­åˆ›å»ºè‡ªå·±çš„è¡¨ï¼Œå› æ­¤ drizzle å¯ä»¥å¿½ç•¥å®ƒä»¬ã€‚

<Section>
```ts filename="drizzle.config.ts" {9-11}
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  dbCredentials: {
    url: "postgresql://user:password@host:port/dbname",
  },
  extensionsFilters: ["postgis"],
  schemaFilter: ["public"],
  tablesFilter: ["*"],
});
```
```shell
npx drizzle-kit push
```
</Section>

### æ‰©å±•çš„é…ç½®é€‰é¡¹åˆ—è¡¨

`drizzle-kit push` æœ‰ä¸€äº›ä»…é™äº CLI çš„é€‰é¡¹

<rem025/>

|           |                                                          |
| :-------- | :---------------------------------------------------     |
| `verbose` | æ‰§è¡Œå‰æ‰“å°æ‰€æœ‰ SQL è¯­å¥                                   |
| `strict`  | æ‰§è¡Œ SQL è¯­å¥å‰å§‹ç»ˆè¦æ±‚ç¡®è®¤                             |
| `force`   | è‡ªåŠ¨æ¥å—æ‰€æœ‰æ•°æ®ä¸¢å¤±çš„è¯­å¥                               |
<br/>
<Npx>
drizzle-kit push --strict --verbose --force
</Npx>

<br/>
<hr/>
<br/>
æˆ‘ä»¬æ¨èé€šè¿‡ [drizzle.config.ts](/docs/drizzle-config-file) æ–‡ä»¶é…ç½® `drizzle-kit`ï¼Œ
ä½†å¦‚æœæœ‰å¿…è¦ï¼Œä½ å¯ä»¥é€šè¿‡ CLI æä¾›æ‰€æœ‰é…ç½®é€‰é¡¹ï¼Œä¾‹å¦‚åœ¨ CI/CD ç®¡é“ä¸­ç­‰ã€‚

|                     |            |                                                                           |
| :------------------ | :--------- | :------------------------------------------------------------------------ |
| `dialect`           | `required` | æ•°æ®åº“æ–¹è¨€ï¼Œå¿…é¡»æ˜¯ <Dialects/>                                      |
| `schema`            | `required` | æŒ‡å‘ TypeScript æ¨¡å¼æ–‡ä»¶æˆ–åŒ…å«å¤šä¸ªæ¨¡å¼æ–‡ä»¶çš„æ–‡ä»¶å¤¹çš„è·¯å¾„ |
| `driver`            |            | é©±åŠ¨ç¨‹åºä¾‹å¤– <Drivers/>                                             |
| `tablesFilter`      |            | è¡¨åè¿‡æ»¤å™¨                                                         |
| `schemaFilter`      |            | æ¨¡å¼åç§°è¿‡æ»¤å™¨ã€‚é»˜è®¤ï¼š`["public"]`                                 |
| `extensionsFilters` |            | æ•°æ®åº“æ‰©å±•å†…éƒ¨æ•°æ®åº“è¿‡æ»¤å™¨                             |
| `url`               |            | æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²                                                |
| `user`              |            | æ•°æ®åº“ç”¨æˆ·                                                             |
| `password`          |            | æ•°æ®åº“å¯†ç                                                          |
| `host`              |            | ä¸»æœº                                                                      |
| `port`              |            | ç«¯å£                                                                      |
| `database`          |            | æ•°æ®åº“åç§°                                                             |
| `config`            |            | é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤=`drizzle.config.ts`                             |

<Npx>
drizzle-kit push dialect=postgresql schema=src/schema.ts url=postgresql://user:password@host:port/dbname
drizzle-kit push dialect=postgresql schema=src/schema.ts driver=pglite url=database/
drizzle-kit push dialect=postgresql schema=src/schema.ts --tablesFilter='user*' --extensionsFilters=postgis url=postgresql://user:password@host:port/dbname
</Npx>


### æ‰©å±•ç¤ºä¾‹
è®©æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å£°æ˜ drizzle æ¨¡å¼å¹¶é€šè¿‡ `drizzle-kit push` å‘½ä»¤å°†å…¶æ¨é€åˆ°æ•°æ®åº“

```plaintext
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ ğŸ“‚ src
 â”‚ â”œ ğŸ“œ schema.ts
 â”‚ â”” ğŸ“œ index.ts
 â”œ ğŸ“œ drizzle.config.ts
 â”” â€¦
```
<CodeTabs items={["drizzle.config.ts", "src/schema.ts"]}>
```ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  dbCredentials: {
    url: "postgresql://user:password@host:port/dbname"
  },
});
```
```ts 
import * as p from "drizzle-orm/pg-core";

export const users = p.pgTable("users", {
  id: p.serial().primaryKey(),
  name: p.text(),
})
```
</CodeTabs>

ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œ
```shell
npx drizzle-kit push
```

å®ƒå°†ä»æ•°æ®åº“ä¸­æ‹‰å–ç°æœ‰ï¼ˆç©ºï¼‰æ¨¡å¼ï¼Œç”Ÿæˆ SQL è¿ç§»å¹¶åœ¨åå°åº”ç”¨å®ƒ
```sql
CREATE TABLE "users"(
  id serial primary key,
  name text,
)
```

å®Œæˆ âœ…
