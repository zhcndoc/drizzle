import Tab from '@components/markdown/Tab.astro';
import Tabs from '@components/markdown/Tabs.astro';
import Callout from '@components/markdown/Callout.astro';
import SimpleLinkCards from '@components/markdown/SimpleLinkCards.astro';

# SQL Schema å£°æ˜

ä½ å¯ä»¥ç›´æ¥åœ¨ TypeScript ä¸­å£°æ˜ä½ çš„ SQL Schemaï¼Œå¯ä»¥åœ¨ä¸€ä¸ªåä¸º `schema.ts` çš„æ–‡ä»¶ä¸­å£°æ˜ï¼Œä¹Ÿå¯ä»¥åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œæ ¹æ®ä¸ªäººå–œå¥½é€‰æ‹©ï¼Œéå¸¸è‡ªç”±ï¼


<Tabs items={['1 ä¸ªæ–‡ä»¶', 'å•ç‹¬çš„æ–‡ä»¶', 'å•ç‹¬çš„æ–‡ä»¶å¤¹']}>
  <Tab>
    æ‰€æœ‰å†…å®¹éƒ½åœ¨ 1 ä¸ªæ–‡ä»¶ä¸­ï¼š
    ```plaintext
ğŸ“¦ <project root>
 â”” ğŸ“‚ src
    â”” ğŸ“‚ db
       â”” ğŸ“œ schema.ts
    ```
  </Tab>
   <Tab>
    åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ï¼š
    ```plaintext
ğŸ“¦ <project root>
 â”” ğŸ“‚ src
    â”” ğŸ“‚ db
       â”” ğŸ“‚ schema
          â”œ ğŸ“œ users.ts
          â”œ ğŸ“œ countries.ts
          â”œ ğŸ“œ cities.ts
          â”œ ğŸ“œ products.ts
          â”œ ğŸ“œ clients.ts
          â”œ ğŸ“œ enums.ts
          â”” ğŸ“œ etc.ts
    ```
  </Tab>
   <Tab>
    åœ¨å•ç‹¬/ç‰¹å®šäºåŸŸçš„æ–‡ä»¶å¤¹ä¸­ï¼š
   ```plaintext
ğŸ“¦ <project root>
 â”” ğŸ“‚ src
    â”œ ğŸ“‚ get-user
    â”‚  â”œ ğŸ“œ user.ts
    â”‚  â”” ğŸ“œ handler.ts
    â”œ ğŸ“‚ get-city
    â”‚  â”œ ğŸ“œ city.ts
    â”‚  â”” ğŸ“œ handler.ts    
    â”œ  ...
    ```
  </Tab>
</Tabs>

ä½ å¯ä»¥å£°æ˜ `tables`ã€`indexes`ã€`constraints`ã€`foreign keys` å’Œ `enums`ã€‚

<Callout type="warning" emoji="âš ï¸">
  å¦‚æœä½¿ç”¨çš„æ˜¯ [drizzle-kit SQL è¿ç§»ç”Ÿæˆå™¨](/docs/migrations)ï¼Œè¯·æ³¨æ„å¼ºåˆ¶ `export` å…³é”®å­—ã€‚
</Callout>

<Tabs items={['PostgreSQL', 'MySQL', 'SQLite']}>
  <Tab>
  ```typescript copy
  import { integer, pgEnum, pgTable, serial, uniqueIndex, varchar } from 'drizzle-orm/pg-core';

  // declaring enum in database
  export const popularityEnum = pgEnum('popularity', ['unknown', 'known', 'popular']);

  export const countries = pgTable('countries', {
    id: serial('id').primaryKey(),
    name: varchar('name', { length: 256 }),
  }, (countries) => {
    return {
      nameIndex: uniqueIndex('name_idx').on(countries.name),
    }
  });

  export const cities = pgTable('cities', {
    id: serial('id').primaryKey(),
    name: varchar('name', { length: 256 }),
    countryId: integer('country_id').references(() => countries.id),
    popularity: popularityEnum('popularity'),
  });
  ```

  æ•°æ®åº“å’Œè¡¨çš„æ˜¾å¼å®ä½“ç±»å‹ï¼š
  ```typescript copy
  import { pgTable, serial, text, varchar } from 'drizzle-orm/pg-core';
  import { drizzle } from 'drizzle-orm/node-postgres';

  export const users = pgTable('users', {
    id: serial('id').primaryKey(),
    fullName: text('full_name'),
    phone: varchar('phone', { length: 256 }),
  });

  export type User = typeof users.$inferSelect; // return type when queried
  export type NewUser = typeof users.$inferInsert; // insert type
  ...

  const db = drizzle(...);

  const result: User[] = await db.select().from(users);

  export async function insertUser(user: NewUser): Promise<User[]> {
    return db.insert(users).values(user).returning();
  }
  ```

  ç‚¹å‡» [æ­¤å¤„](/docs/column-types/pg) æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„ PostgreSQL åˆ—ç±»å‹ã€‚
  </Tab>
  <Tab>
  ```typescript copy
  import { int, mysqlEnum, mysqlTable, uniqueIndex, varchar, serial } from 'drizzle-orm/mysql-core';

  // declaring enum in database
  export const countries = mysqlTable('countries', {
    id: serial("id").primaryKey(),
    name: varchar('name', { length: 256 }),
  }, (countries) => ({
    nameIndex: uniqueIndex('name_idx').on(countries.name),
  }));

  export const cities = mysqlTable('cities', {
    id: serial("id").primaryKey(),
    name: varchar('name', { length: 256 }),
    countryId: int('country_id').references(() => countries.id),
    popularity: mysqlEnum('popularity', ['unknown', 'known', 'popular']),
  });
  ```

  æ•°æ®åº“å’Œè¡¨çš„æ˜¾å¼å®ä½“ç±»å‹ï¼š
  ```typescript copy
  import { MySqlRawQueryResult, mysqlTable, serial, text, varchar } from 'drizzle-orm/mysql-core';
  import mysql from 'mysql2/promise';
  import { drizzle } from 'drizzle-orm/mysql2';

  export const users = mysqlTable('users', {
    id: serial("id").primaryKey(),
    fullName: text('full_name'),
    phone: varchar('phone', { length: 256 }),
  });

  export type User = typeof users.$inferSelect; // return type when queried
  export type NewUser = typeof users.$inferInsert; // insert type
  ...

  // åˆå§‹åŒ– mysql2 Pool æˆ– Client
  const poolConnection = mysql.createPool({
      host:'localhost', 
      user: 'root',
      database: 'test'
  });

  export const db = drizzle(poolConnection);

  const result: User[] = await db.select().from(users);

  async function insertUser(user: NewUser): Promise<MySqlRawQueryResult> {
    return db.insert(users).values(user);
  }
  ```

  ç‚¹å‡» [æ­¤å¤„](/docs/column-types/mysql) æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„ MySQL åˆ—ç±»å‹ã€‚
  </Tab>
  <Tab>
  ```typescript copy
  import { sqliteTable, text, integer, uniqueIndex } from 'drizzle-orm/sqlite-core';

  export const countries = sqliteTable('countries', {
      id: integer('id').primaryKey(),
      name: text('name'),
    }, (countries) => ({
      nameIdx: uniqueIndex('nameIdx').on(countries.name),
    })
  );

  export const cities = sqliteTable('cities', {
    id: integer('id').primaryKey(),
    name: text('name'),
    countryId: integer('country_id').references(() => countries.id),
  })
  ```

  æ•°æ®åº“å’Œè¡¨çš„æ˜¾å¼å®ä½“ç±»å‹ï¼š

  ```typescript copy
  import { text, integer, sqliteTable } from 'drizzle-orm/sqlite-core';

  export const users = sqliteTable('users', {
    id: integer('id').primaryKey(),
    fullName: text('full_name'),
    phone: text('phone'),
  })

  export type User = typeof users.$inferSelect // return type when queried
  export type InsertUser = typeof users.$inferInsert // insert type
  ...
  import { drizzle } from 'drizzle-orm/better-sqlite3';
  import Database from 'better-sqlite3';

  const sqlite = new Database('sqlite.db');
  const db = drizzle(sqlite);

  const result: User[] = db.select().from(users).all();

  const insertUser = (user: InsertUser) => {
    return db.insert(users).values(user).run()
  }
  ```

  ç‚¹å‡» [æ­¤å¤„](/docs/column-types/sqlite) æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„ SQLite åˆ—ç±»å‹ã€‚
  </Tab>
</Tabs>

<SimpleLinkCards cards={{
  "PostgreSQL åˆ—ç±»å‹": "/docs/column-types/pg",
  "MySQL åˆ—ç±»å‹": "/docs/column-types/mysql",
  "SQLite åˆ—ç±»å‹": "/docs/column-types/sqlite",
}}/>
