import Tab from '@components/markdown/Tab.astro';
import Tabs from '@components/markdown/Tabs.astro';
import Npm from "@components/markdown/Npm.astro";
import Callout from '@components/markdown/Callout.astro';
import Steps from '@components/markdown/Steps.astro';
import AnchorCards from '@components/markdown/AnchorCards.astro';
import Prerequisites from "@mdx/Prerequisites.astro";
import CodeTabs from '@components/markdown/CodeTabs.astro';
import CodeTab from '@components/markdown/CodeTab.astro';
import Section from "@mdx/Section.astro";
import LinksList from "@mdx/LinksList.astro"
import Flex from "@mdx/Flex.astro"

# Database connection with Drizzle
Drizzle ORM runs SQL queries on your database via **database drivers**.
<CodeTabs items={["index.ts", "schema.ts"]}>

<CodeTab>
```ts
import { drizzle } from "drizzle-orm/connect"
import { users } from "./schema"

const db = await drizzle("node-postgres", process.env.DATABASE_URL);
const usersCount = await db.$count(users);
```
```  
                        ┌──────────────────────┐
                        │   db.$count(users)   │ <--- drizzle query
                        └──────────────────────┘     
                            │               ʌ
select count(*) from users -│               │
                            │               │- [{ count: 0 }]
                            v               │
                         ┌─────────────────────┐
                         │    node-postgres    │ <--- database driver
                         └─────────────────────┘
                            │               ʌ
01101000 01100101 01111001 -│               │
                            │               │- 01110011 01110101 01110000
                            v               │
                         ┌────────────────────┐
                         │      Database      │ 
                         └────────────────────┘
```
</CodeTab>

```ts
import { pgTable, integer, text } from "drizzle-orm";

export const users = pgTable("users", {
  id: integer("id").generateAlwaysAsIdentity(),
  name: text("name"),
})
```
</CodeTabs>

Under the hood Drizzle will create a **node-postgres** driver instance which you can access via `db.$client` if necessary
<Section>
```ts
import { drizzle } from "drizzle-orm/connect"

const db = await drizzle("node-postgres", process.env.DATABASE_URL);
const pool = db.$client;
```
```ts
// above is equivalent to
import { drizzle } from "drizzle-orm/node-postgres";
import { Pool } from "pg";

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
});
const db = drizzle(pool); // <--- sync 
```
</Section>

The latter API is our original API which you can use when you need drizzle initialization to be synchronous.  
Mostly every driver supports initialization via either **connection URL** or a set of **connection params**  
```ts
import { drizzle } from "drizzle-orm/connect"

const db = await drizzle("node-postgres", "postgresql://users:password@127.0.0.1:5432/dbname");

// above is equivalent to
const db = await drizzle("node-postgres", {
  connection: {
    user: "user",
    password: "password",
    host: "127.0.0.1",
    port: 5432,
    database: "dbname",
  },
})
```

Drizzle is by design natively compatible with every **edge** or **serverless** runtime, whenever you'd need access to a serverless database - we've got you covered
```ts
import { drizzle } from "drizzle-orm/connect";

const db = await drizzle("neon-http", process.env.DATABASE_URL);
const db = await drizzle("neon-websocket", process.env.DATABASE_URL);
const db = await drizzle("vercel-postgres");
const db = await drizzle("planetscale", process.env.DATABASE_URL);
const db = await drizzle("d1", { connection: env.DB });
```
And yes, we do support runtime specific drivers like [Bun SQLite](/docs/connect-bun-sqlite) or [Expo SQLite](/docs/connect-expo-sqlite):
<Section>
```ts
import { drizzle } from "drizzle-orm/connect"

const db = await drizzle("bun:sqlite"); // <--- will create inmemory db
const db = await drizzle("bun:sqlite", "./sqlite.db");
```
```ts
import { drizzle } from "drizzle-orm/expo-sqlite";
import { openDatabaseSync } from "expo-sqlite/next";

const expo = openDatabaseSync("db.db");
const db = drizzle(expo);
```
</Section>

#### Database connection URL
Just in case if you're not familiar with database connection URL concept
```
postgresql://alex:AbC123dEf@ep-cool-darkness-123456.us-east-2.aws.neon.tech/dbname
             └──┘ └───────┘ └─────────────────────────────────────────────┘ └────┘
              ʌ    ʌ          ʌ                                              ʌ
        role -│    │          │- hostname                                    │- database
                   │
                   │- password

```
#### Next steps
Feel free to check out per-driver documentations  

<rem/>
<Flex>
  <LinksList 
    title='PostgreSQL drivers'
    links={[
        ["PostgreSQL", "/docs/get-started-postgresql"], 
        ["Neon", "/docs/connect-neon"], 
        ["Vercel Postgres", "/docs/connect-vercel-postgres"],
        ["Supabase", "/docs/connect-supabase"],
        ["Xata", "/docs/connect-xata"],
        ["PGLite", "/docs/connect-pglite"],
      ]}
  />
  <LinksList 
    title='MySQL drivers'
    links={[
        ["MySQL", "/docs/get-started-mysql"], 
        ["PlanetsScale", "/docs/connect-planetscale"], 
        ["TiDB", "/docs/connect-tidb"],
      ]}
  />
  <LinksList 
  title='SQLite drivers'
  links={[
      ["SQLite", "/docs/get-started-sqlite"], 
      ["Turso", "/docs/connect-turso"], 
      ["Cloudflare D1", "/docs/connect-cloudflare-d1"],
      ["Bun SQLite", "/docs/connect-bun-sqlite"],
    ]}
  />
  <LinksList 
  title='Native SQLite'
  links={[
      ["Expo SQLite", "/docs/get-started/expo-new"], 
      ["OP SQLite", "/docs/connect-op-sqlite"], 
      ["React Native SQLite", "/docs/connect-react-native-sqlite"],
    ]}
  />
  <LinksList 
  title='Others'
  links={[
      ["Drizzle Proxy", "/docs/connect-drizzle-proxy"], 
    ]}
  />
</Flex>
{/* TODO: @AndriiSherman ["AWS Data API", "/docs/get-started/aws-data-api"],  */}