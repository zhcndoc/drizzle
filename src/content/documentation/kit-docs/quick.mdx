import Npm from "@components/markdown/Npm.astro";

# å¿«é€Ÿå¼€å§‹
è®©æˆ‘ä»¬é€šè¿‡ `PostgreSQL` + `postgresjs` æ„å»ºä¸€ä¸ªå¿«é€Ÿå¼€å§‹çš„åº”ç”¨ï¼Œå¹¶è¿è¡Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè¿ç§»ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… `drizzle-orm` å’Œ `drizzle-kit`ï¼š

<Npm>
drizzle-orm postgres
-D drizzle-kit
</Npm>

è®©æˆ‘ä»¬å£°æ˜æˆ‘ä»¬çš„ `schema.ts`ï¼š

```plaintext {4}
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ ...
 â”œ ğŸ“‚ src
 â”‚ â”” ğŸ“œ schema.ts
 â”” ğŸ“œ package.json
```
```ts copy filename="schema.ts"
import { serial, text, timestamp, pgTable } from "drizzle-orm/pg-core";

export const user = pgTable("user", {
  id: serial("id"),
  name: text("name"),
  email: text("email"),
  password: text("password"),
  role: text("role").$type<"admin" | "customer">(),
  createdAt: timestamp("created_at"),
  updatedAt: timestamp("updated_at"),
});
```

ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ  drizzle é…ç½®æ–‡ä»¶ï¼š
```plaintext {4}
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ ...
 â”œ ğŸ“‚ src
 â”œ ğŸ“œ drizzle.config.ts
 â”” ğŸ“œ package.json
```
```ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
  out: "./drizzle",
});
```

å°† `generate` å’Œ `migrate` å‘½ä»¤æ·»åŠ åˆ° `package.json` ä¸­ï¼Œå¹¶è¿è¡Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè¿ç§»ç”Ÿæˆå‘½ä»¤ï¼š

```json filename="package.json" {5,6}
{
  "name": "first time?",
  "version": "0.0.1",
  "scripts": {
    "generate": "drizzle-kit generate",
    "migrate": "drizzle-kit migrate"
  }, 
}
```
```shell filename="terminal"
$ npm run generate
...

[âœ“] ä½ çš„ SQL è¿ç§»æ–‡ä»¶ âœ drizzle/0000_pale_mister_fear.sql ğŸš€
```

å®Œæˆäº†ï¼æˆ‘ä»¬ç°åœ¨æœ‰äº†æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª SQL è¿ç§»æ–‡ä»¶ ğŸ¥³
```plaintext {4}
ğŸ“¦ <é¡¹ç›®æ ¹ç›®å½•>
 â”œ ğŸ“‚ drizzle
 â”‚ â”œ ğŸ“‚ _meta
 â”‚ â”” ğŸ“œ 0000_pale_mister_fear.sql
 â”œ ğŸ“‚ src
 â”œ ğŸ“œ drizzle.config.ts
 â”” ğŸ“œ package.json
```
ç°åœ¨è®©æˆ‘ä»¬è¿è¡Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ•°æ®åº“è¿ç§»ï¼š

```shell filename="terminal"
$ npm run migrate
```

å°±æ˜¯è¿™æ ·ï¼Œæœ‹å‹ä»¬ï¼  

**æˆ‘çš„ä¸ªäººç¥è´º ğŸ‰**