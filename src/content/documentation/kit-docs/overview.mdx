import CodeTab from '@components/markdown/CodeTab.astro';
import CodeTabs from '@components/markdown/CodeTabs.astro';
import Section from '@components/markdown/Section.astro';
import Tab from '@components/markdown/Tab.astro';
import Tabs from '@components/markdown/Tabs.astro';
import Callout from '@components/markdown/Callout.astro';
import Button from '@components/markdown/Button.astro';
import Npm from '@components/markdown/Npm.astro';

# Drizzle Kit
æˆ‘ä»¬ Drizzle ORM æœ€åŸºæœ¬çš„è®¾è®¡åŸåˆ™æ˜¯å§‹ç»ˆæ˜ç¡®ã€æä¾›é€‰æ‹©æ€§è§£å†³æ–¹æ¡ˆå¹¶ä¸”ä¸è¿›è¡Œå¹²é¢„ã€‚æˆ‘ä»¬çš„è¿ç§»å·¥å…·åŒ…ä¹Ÿä¸ä¾‹å¤–ã€‚

<Npm>
-D drizzle-kit
</Npm>

## æ¦‚è§ˆ
**Drizzle Kit** æ˜¯ç”¨äºç”Ÿæˆè‡ªåŠ¨ SQL è¿ç§»å’Œå¿«é€ŸåŸå‹å¼€å‘çš„ CLI å·¥å…·ã€‚

ä»æ¦‚å¿µä¸Šè®²ï¼Œå®ƒéå¸¸ç®€å•ï¼Œä½ åªéœ€è¦å£°æ˜ä¸€ä¸ª Drizzle ORM çš„ TypeScript schemaï¼Œç„¶åä»ä¸­ç”Ÿæˆä¸€ä¸ª SQL è¿ç§»ã€‚

ç„¶åä½ å¯ä»¥æ›´æ”¹åŸå§‹çš„ schemaï¼ŒDrizzle Kit å°†ç”Ÿæˆæ–°çš„è¿ç§»ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åœ¨ä¸€ä¸ªç±»å‹å®‰å…¨çš„åœ°æ–¹æ‹¥æœ‰ DDL çš„çœŸå®æºï¼Œå¹¶è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚

Drizzle Kit å…è®¸ä½ å°† schema æ‹†åˆ†åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œç”šè‡³åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ä¸ºä¸åŒçš„æ•°æ®åº“æœ‰å¤šä¸ª schemasã€‚ä½ å¯ä»¥å¿«é€ŸåŸå‹æ•°æ®åº“ schema å¹¶ç›´æ¥æ¨é€åˆ°æ•°æ®åº“ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä½ å¯ä»¥åœ¨å‡ ç§’é’Ÿå†…ä»ç°æœ‰çš„æ•°æ®åº“ä¸­æ‹‰å– schema âš¡ï¸

## è¿ç§»æ–‡ä»¶
è¿ç§»å†å²å­˜å‚¨åœ¨ migrations æ–‡ä»¶å¤¹ä¸­çš„ `.sql` æ–‡ä»¶ä¸­
```plaintext {3,5-8}
ğŸ“¦ <project root>
 â”œ ...
 â”œ ğŸ“‚ drizzle
 â”‚ â”œ ğŸ“‚ _meta
 â”‚ â”œ ğŸ“œ 0000_premium_mister_fear.sql
 â”‚ â”œ ğŸ“œ 0001_absurd_toad.sql
 â”‚ â”œ ğŸ“œ 0002_adorable_human_torch.sql
 â”‚ â”” ğŸ“œ 0003_boring_silver_sable.sql
 â”œ ...
 â”œ ğŸ“‚ src
 â”œ ğŸ“œ package.json
 â”” ...
```

æ¯ä¸ª SQL è¿ç§»æ–‡ä»¶åŒ…å«ä½ åœ¨æ•°æ®åº“ä¸­åº”ç”¨çš„è¯­å¥ã€‚
ä½ å¯ä»¥ä½¿ç”¨ Drizzle ORM è¿ç§»åŒ…æˆ–é€‚åˆä½ çš„ä¸šåŠ¡æ¡ˆä¾‹æˆ–ä¸ªäººåå¥½çš„ä»»ä½•å…¶ä»–æ–¹å¼ã€‚

<CodeTabs items={["0000_premium_mister_fear.sql", "schema.ts"]}>
  ```sql
  CREATE TABLE IF NOT EXISTS "user" (
    "id" serial,
    "name" text,
    "email" text,
    "password" text,
    "role" text,
    "created_at" timestamp,
    "updated_at" timestamp
  );
  ```
  ```typescript
  export const user = pgTable("user", {
    id: serial("id"),
    name: text("name"),
    email: text("email"),
    password: text("password"),
    role: text("role").$type<"admin" | "customer">(),
    createdAt: timestamp("created_at"),
    updatedAt: timestamp("updated_at"),
  });
  ```
</CodeTabs>

You can also configure the prefixes for migrations, so they can be in a format that is compliant with the migration tool you are using or for your own convenience, for example Supabase would need `20240710095007_*.sql` format and drizzle has `0000_*.sql` be default

You can check all the prefix options [here](/kit-docs/config-reference#migrationsprefix)

<Callout type="warning">
You can use prefixes only if you don't have any migration history already. The kit won't work properly if you mix prefix formats within the same migration folder. Please ensure you use only one prefix format throughout the project.

We are working on making it possible to migrate from one prefix format to another and to ensure interoperability
</Callout>

<CodeTabs items={["drizzle.config.ts"]}>
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  schema: "./schema.ts",
  dialect: 'postgresql',
  migrations: {
    prefix: 'supabase'
  }
})
```
</CodeTabs>

## Schema æ›´æ–°
æ¯å½“ä½ å¯¹ schema è¿›è¡Œæ›´æ”¹æ—¶ï¼Œåªéœ€è¦é‡æ–°è¿è¡Œ `$ drizzle-kit generate`ï¼Œ
å®ƒå°†æ ¹æ®å¤§å¤šæ•°æƒ…å†µè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆ SQL è¿ç§»ã€‚
<CodeTabs items={["0001_absurd_toad.sql", "schema.ts"]}>
  ```sql
  ALTER TABLE "user" ADD COLUMN "is_verified" boolean;
  ```
  ```typescript {6}
  export const user = pgTable("user", {
    id: serial("id"),
    name: text("name"),
    email: text("email"),
    password: text("password"),
    isVerified: boolean("is_verified"),
    role: text("role").$type<"admin" | "customer">(),
    createdAt: timestamp("created_at"),
    updatedAt: timestamp("updated_at"),
  });
  ```
</CodeTabs>

## è¿è¡Œè¿ç§»
æˆ‘ä»¬å¯¹å¦‚ä½•è¿è¡Œè¿ç§»ä¸æŒæœ‰æ„è§ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨è¿è¡Œå®ƒä»¬ä½¿ç”¨ SQL ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä½¿ç”¨å¤–éƒ¨å·¥å…·ç­‰ç­‰ï¼Œæˆ–è€…ä½¿ç”¨ **Drizzle Kit** æˆ– **Drizzle ORM**ã€‚

**ä½¿ç”¨ Drizzle Kit**

æ‚¨å¯ä»¥ä½¿ç”¨æœ¬åœ°è¿ç§» CLI å‘½ä»¤ `drizzle-kit migrate`ã€‚ å®ƒå°†ä» `drizzle.config.ts` æ–‡ä»¶ä¸­è·å–æ‰€æœ‰éœ€è¦çš„ä¿¡æ¯æ¥è¿è¡Œè¿ç§»ï¼Œå‰ææ˜¯ä¹‹å‰å·²ç»è¿è¡Œäº† `drizzle-kit generate` ã€‚

æ‚¨å¯ä»¥åœ¨ `drizzle.config.ts` ä¸­æŒ‡å®šè‡ªå®šä¹‰æ¨¡å¼å’Œè¿ç§»è¡¨åç§°ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹[æ–‡æ¡£](/kit-docs/commands#apply-migrations)ã€‚

```bash
# æ‚¨éœ€è¦åœ¨è°ƒç”¨æ­¤å‘½ä»¤ä¹‹å‰è¿è¡Œ `drizzle-kit generate`ã€‚
drizzle-kit migrate
```

**ä½¿ç”¨ Drizzle ORM**

æˆ‘ä»¬è¿˜ä¸ºä½ æä¾›äº†ä¸€ç§æœ‰ç”¨çš„æ–¹å¼æ¥è¿è¡Œç”Ÿæˆçš„è¿ç§»ï¼Œå³ä½¿ç”¨ç‰¹æ®Šåœ°ä¸ºæ¯ä¸ªé©±åŠ¨ç¨‹åºå’Œæ–¹è¨€å®ç°çš„ `migrate` å‡½æ•°ã€‚

Drizzle å°†è‡ªåŠ¨è·Ÿè¸ªåº”ç”¨äºä½ çš„æ•°æ®åº“çš„è¿ç§»ã€‚

<Callout type="info" emoji="â„¹ï¸">
`drizzle` å’Œ `migrate` çš„å¯¼å…¥å–å†³äºä½ æ­£åœ¨ä½¿ç”¨çš„[æ•°æ®åº“é©±åŠ¨](/docs/installation-and-db-connection)ã€‚
</Callout>

<Tabs items={["PostgreSQL", "MySQL", "SQLite"]}>
<Tab>
```ts
import { drizzle } from "drizzle-orm/postgres-js";
import { migrate } from "drizzle-orm/postgres-js/migrator";
import postgres from "postgres";

const sql = postgres("...", { max: 1 })
const db = drizzle(sql);

await migrate(db, { migrationsFolder: "drizzle" });

await sql.end();
```
</Tab>
<Tab>
```ts
import { drizzle } from "drizzle-orm/mysql2";
import { migrate } from "drizzle-orm/mysql2/migrator";
import { createConnection } from "mysql2";

const connection = createConnection("...")
const db = drizzle(connection);

await migrate(db, { migrationsFolder: "drizzle" });

await connection.end();
```
</Tab>
<Tab>
```ts
import { drizzle } from "drizzle-orm/better-sqlite3";
import { migrate } from "drizzle-orm/better-sqlite3/migrator";
import Database from "better-sqlite3";

const betterSqlite = new Database(":memory:");
const db = drizzle(betterSqlite);

migrate(db, { migrationsFolder: "drizzle" });

betterSqlite.close()
```
</Tab>
</Tabs>

## é…ç½®
Drizzle Kit å…è®¸ä½ åœ¨ `TypeScript`ã€`JavaScript` æˆ– `JSON` é…ç½®æ–‡ä»¶ä¸­å£°æ˜é…ç½®ã€‚

ä½ å¯ä»¥äº«å—è‡ªåŠ¨è¡¥å…¨çš„ä½“éªŒå’Œéå¸¸ä¾¿åˆ©çš„ç¯å¢ƒå˜é‡æµç¨‹ï¼

<CodeTabs items={["drizzle.config.ts", "drizzle.config.js", "drizzle.config.json"]}>
<CodeTab>
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  schema: "./schema.ts",
  dialect: 'postgresql',
  dbCredentials: {
    url: process.env.DB_URL,
  },
  verbose: true,
  strict: true,
})
```
</CodeTab>
<CodeTab>
```js
/** @type { import("drizzle-kit").Config } */
export default {
  schema: "./schema.ts",
  dialect: 'postgresql',
  dbCredentials: {
    url: process.env.DB_URL,
  }
};
```
</CodeTab>
<CodeTab>
```json
{
  "dialect": "postgresql",
  "out": "./migrations-folder",
  "schema": "./src/db",
  "breakpoints": false
}
```
</CodeTab>
</CodeTabs>

æœ‰å…³æ‰€æœ‰é…ç½®å‚æ•°çš„åˆ—è¡¨ï¼Œè¯·å‚é˜…**[è¿™é‡Œ](/kit-docs/conf)**ã€‚

## ä½¿ç”¨ db push è¿›è¡ŒåŸå‹å¼€å‘
Drizzle Kit å…è®¸ä½ æ›´æ”¹æ•°æ®åº“ schema å¹¶ä½¿ç”¨ db **[`push` command](/kit-docs/commands#prototype--push)** è¿…é€Ÿå‘å‰æ¨è¿›ã€‚

å½“ä½ æ‹¥æœ‰åƒ **[Neon](/docs/get-started-postgresql#neon)**ã€**[Planetscale](/docs/get-started-mysql#planetscale)** æˆ– **[Turso](/docs/get-started-sqlite#turso)** ç­‰è¿œç¨‹æ•°æ®åº“æ—¶ï¼Œè¿™éå¸¸æ–¹ä¾¿ã€‚

### æ¦‚è§ˆ

å¦‚æœä½ æƒ³åœ¨æœ¬åœ°å¼€å‘ä¸­å¿«é€Ÿè¿­ä»£æˆ–è€…é¡¹ç›®ä¸éœ€è¦è¿ç§»æ–‡ä»¶ï¼ŒDrizzle æä¾›äº†ä¸€ä¸ªå¥½ç”¨çš„å‘½ä»¤ `drizzle-kit push`ã€‚

ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨ 'push' å‘½ä»¤ï¼Ÿ

1. åœ¨æœ¬åœ°ç¯å¢ƒä¸­ schema çš„åŸå‹å’Œå®éªŒé˜¶æ®µã€‚
2. å½“ä½ ä½¿ç”¨ç®¡ç†è¿ç§»å’Œ schema å˜æ›´çš„å¤–éƒ¨æä¾›å•†æ—¶ï¼ˆä¾‹å¦‚ PlanetScaleï¼‰ã€‚
3. åœ¨ä½ çš„ä»£ç æ›´æ”¹å¯ä»¥éƒ¨ç½²ä¹‹å‰ï¼Œä½ å¯ä»¥ä¿®æ”¹æ•°æ®åº“ schemaã€‚

### å·¥ä½œåŸç†

å½“ä½ è¿è¡Œ `drizzle-kit push` å‘½ä»¤æ—¶ï¼ŒDrizzle æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. å®ƒä»æ•°æ®åº“ä¸­æ£€ç´¢ä½ çš„ schemaï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º "drizzle-schema" æ ¼å¼ã€‚
2. è¯¥å‘½ä»¤è¿˜ä¼šè¯»å–åŒ…å« drizzle è¡¨çš„æ‰€æœ‰ schema æ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º "drizzle-schema" æ ¼å¼ã€‚
3. æ¥ä¸‹æ¥ï¼ŒDrizzle å°†æ¯”è¾ƒè¿™ä¸¤ä¸ª schemasï¼Œå¹¶ç”Ÿæˆä¸€ç»„éœ€è¦åœ¨ä½ çš„æ•°æ®åº“ä¸Šæ‰§è¡Œçš„è¯­å¥ã€‚
è¿™äº›è¯­å¥ç¡®ä¿æ•°æ®åº“ä¸ä½ ä»£ç ä¸­å®šä¹‰çš„ schema åŒæ­¥ã€‚

```bash
$ drizzle-kit push
```
æœ‰å…³æ‰©å±•çš„ `push` ç¤ºä¾‹ï¼Œ**[è¯·å‚é˜…è¿™é‡Œ](/kit-docs/commands#prototype--push)**ã€‚

## ä½¿ç”¨ db pull è¿›è¡Œè‡ªçœ
Drizzle Kit å…è®¸ä½ ä»ç°æœ‰æ•°æ®åº“ä¸­æ‹‰å– DDLï¼Œå¹¶å®Œå…¨è‡ªåŠ¨æ‰“å°ä¸€ä¸ª TypeScript schema æ–‡ä»¶ã€‚

<Section>
```bash
$ drizzle-kit introspect
```
```plaintext {6}
ğŸ“¦ <project root>
 â”œ ...
 â”œ ğŸ“‚ drizzle
 â”‚ â”œ ğŸ“‚ _meta
 â”‚ â”œ ğŸ“œ 0000_premium_mister_fear.sql
 â”‚ â”” ğŸ“œ schema.ts
 â”œ ...
 â”œ ğŸ“‚ src
 â”œ ğŸ“œ package.json
 â”” ...
```
```ts
 export const user = pgTable("user", {
    id: serial("id"),
    name: text("name"),
    email: text("email"),
    password: text("password"),
    role: text("role").$type<"admin" | "customer">(),
    createdAt: timestamp("created_at"),
    updatedAt: timestamp("updated_at"),
  });
```
</Section>
æœ‰å…³æ‰©å±•çš„ `introspect` ç¤ºä¾‹ï¼Œè¯·**[å‚é˜…æ­¤å¤„](/kit-docs/commands/#introspect--pull)**ã€‚

## Drizzle Studio
Drizzle Kit å¸¦æœ‰æ†ç»‘çš„**[Drizzle Studio](/drizzle-studio/overview)**æ•°æ®åº“æµè§ˆå™¨ï¼Œå¹¶è®©ä½ åªéœ€ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥åœ¨æœ¬åœ°å¯åŠ¨ã€‚

![Drizzle Studio](@/assets/images/drizzle-studio-light.webp)

Studio éœ€è¦æä¾›å…·æœ‰ `schema` å’Œ `dbCredentials` çš„ drizzle é…ç½®æ–‡ä»¶ã€‚
```bash
drizzle-kit studio

drizzle-kit studio --port 3000 ## è‡ªå®šä¹‰ç«¯å£
drizzle-kit studio --host 0.0.0.0 ## è‡ªå®šä¹‰ Studio æœåŠ¡å™¨çš„ä¸»æœº
drizzle-kit studio --verbose   ## è®°å½•æ‰€æœ‰çš„ SQL è¯­å¥
```

<Button href="https://demo.drizzle.studio" value="ğŸ–¥ Drizzle Studio æ¼”ç¤º"/>

<Button href="https://local.drizzle.studio" value="ğŸ–¥ æ‰“å¼€ Drizzle Studio"/>
