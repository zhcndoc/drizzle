import Tab from "@/components/markdown/Tab.astro";
import Tabs from "@/components/markdown/Tabs.astro";
import Callout from "@/components/markdown/Callout.astro";

# é…ç½® Drizzle kit

## é…ç½®

é»˜è®¤æƒ…å†µä¸‹ï¼ŒDrizzle ä¼šè¯»å–ä½äºé¡¹ç›®æ ¹ç›®å½•çš„ `drizzle.config.ts` æ–‡ä»¶ã€‚ 
å¦‚æœæ‚¨éœ€è¦æŒ‡å®šä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨ä»»ä½• drizzle-kit å‘½ä»¤åé¢ä½¿ç”¨ `--config=<path>` å‘½ä»¤è¡Œé€‰é¡¹ã€‚

Drizzle Kit æ”¯æŒå¤šç§é…ç½®æ–‡ä»¶æ ¼å¼ï¼ŒåŒ…æ‹¬ `.ts`ã€`.js`ã€‚
è¿™ç§çµæ´»æ€§å…è®¸æ‚¨é€‰æ‹©æœ€é€‚åˆæ‚¨éœ€æ±‚å’Œåå¥½çš„æ ¼å¼ã€‚

ä»¥ä¸‹æ˜¯æ¯ç§æ–‡ä»¶æ ¼å¼ç”¨æ³•çš„ä¾‹å­ï¼š

**Typescript ç¤ºä¾‹**
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  dialect: "postgresql",
  schema: "./schema.ts",
  out: "./drizzle"
})
```

**JavaScript ç¤ºä¾‹**
```js
/** @type { import("drizzle-kit").Config } */
export default {
  dialect: "postgresql",
  schema: "./schema.ts",
  out: "./drizzle"
};
```

## é€‰é¡¹

### dialect

- **ç±»å‹**: `'postgresql' | 'mysql' | 'sqlite'`
- **å‘½ä»¤**: æ‰€æœ‰å‘½ä»¤

<Callout type="warning" emoji="âš ï¸">
	å½“å‰å‚æ•°é€‚ç”¨äº `drizzle-kit@0.21.0` åŠæ›´é«˜ç‰ˆæœ¬ã€‚åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œä¸åº”ä½¿ç”¨æ­¤å‚æ•°ã€‚
</Callout>

`dialect` å‚æ•°è´Ÿè´£æ˜ç¡®æŒ‡å®šæ‚¨æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“æ–¹è¨€
å¯¹äºæ‰€æœ‰å‘½ä»¤

**ç”¨æ³•**
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  dialect: "postgresql",
})
```

### schema

- **ç±»å‹**: `string | string[]`
- **å‘½ä»¤**: `generate`, `check`, `up`, `push`, `drop`

`schema` å‚æ•°å…è®¸æ‚¨å®šä¹‰æ¨¡å¼æ–‡ä»¶çš„ä½ç½®ã€‚

æ‚¨å¯ä»¥æ‹¥æœ‰ä»»æ„æ•°é‡çš„å•ç‹¬æ¨¡å¼æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨
**[`glob`](https://www.digitalocean.com/community/tools/glob?comments=true&glob=/**/*.js&matches=false&tests=//%20This%20will%20match%20as%20it%20ends%20with%20'.js'&tests=/hello/world.js&tests=//%20This%20won't%20match!&tests=/test/some/globs)**
æˆ–è€… globs è¯­æ³•çš„æ•°ç»„æ¥å®šä¹‰å®ƒä»¬çš„è·¯å¾„ã€‚

**ç”¨æ³•**
<Tabs items={["å•ä¸ªæ–‡ä»¶", "å¤šä¸ªæ–‡ä»¶", "Glob æ¨¡å¼"]}>
<Tab>
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  schema: "./schema.ts",
})
```
</Tab>
<Tab>
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  schema: ["./user.sql.ts", "./post.sql.ts"],
})
```
</Tab>
<Tab>
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  schema: "./schema/*.ts",
})
```
</Tab>
</Tabs>

### out

- **ç±»å‹**: `string | string[]`
- **ç¼ºçœå€¼**: `drizzle`
- **å‘½ä»¤**: `generate`, `check`, `up`, `drop`, `introspect`, `migrate`

`out` å‚æ•°å…è®¸æ‚¨å®šä¹‰è¿ç§»æ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚

åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­ï¼Œdrizzle-kit å°†ï¼š

1. å­˜å‚¨è¿ç§»æ–‡ä»¶ã€`meta` å’Œ `journal`
2. åœ¨è¿è¡Œ `drizzle-kit introspect` æ—¶è¾“å‡º `schema.ts` æ–‡ä»¶

**ç”¨æ³•**
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  out: "./drizzle",
})
```

### driver

- **ç±»å‹**: `'aws-data-api' | 'd1-http' | 'expo' | 'turso'`
- **å‘½ä»¤**: `push`, `introspect`, `migrate`

`driver` å‚æ•°è´Ÿè´£æ˜ç¡®æä¾›è¦åœ¨è®¿é—®æ•°æ®åº“æ—¶ä½¿ç”¨çš„é©±åŠ¨ç¨‹åºï¼Œ
ç”¨äºå½•åƒå’Œæ¨é€å‘½ä»¤ã€‚è¿™å¯¹äºä½¿ç”¨åŸºäº HTTP çš„æ•°æ®åº“å¹¶ä¸”ä½¿ç”¨æ•°æ®åº“è¿æ¥ URL è¿æ¥ä¸å¯è¡Œçš„æƒ…å†µéå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œ**[Turso](https://turso.tech/drizzle)** å’Œ **[Cloudflare D1](https://developers.cloudflare.com/d1/)**ï¼

**ç”¨æ³•**
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  driver: "aws-data-api"
})
```

### dbCredentials

- **ç±»å‹**: `PostgresCredentials, MySQLCredentials, SQLiteCredentials, TursoCredentials`
- **å‘½ä»¤**: `push`, `introspect`

<Callout>
	æ¯ä¸ª `dialect` éƒ½åº”è¯¥æœ‰ `dbCredentials` å­—æ®µï¼Œä»¥æä¾›ä¸æ•°æ®åº“è¿æ¥çš„æ‰‹æ®µã€‚
</Callout>

**PostgresCredentials** (`postgresql`)
<Tabs items={["é€‰é¡¹ 1", "é€‰é¡¹ 2"]}>
<Tab>
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  dbCredentials: {
    url: '',
  }
})
```
</Tab>
<Tab>
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  dbCredentials: {
    host: "",
    port: "",
    user: "",
    password: "",
    database: "",
    ssl: true, // can be boolean | "require" | "allow" | "prefer" | "verify-full" | options from node:tls
  }
})
```
</Tab>
</Tabs>

**MySQLCredentials** (`mysql`)
<Tabs items={["é€‰é¡¹ 1", "é€‰é¡¹ 2"]}>
<Tab>
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  dbCredentials: {
    url: '',
  }
})
```
</Tab>
<Tab>
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  dbCredentials: {
    host: "",
    port: "",
    user: "",
    password: "",
    database: "",
    ssl: "" // can be: string | SslOptions (ssl options from mysql2 package)
  }
})
```
</Tab>
</Tabs>

**SQLiteCredentials** (`libsql`, `better-sqlite3`)
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  dbCredentials: {
    url: '', // ğŸ‘ˆ this could also be a path to the local sqlite file
  }
})
```

**TursoCredentials** (`turso`)
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  dialect: "sqlite",
  driver: "turso",
  dbCredentials: {
    url: '',
    authToken: ''
  }
})
```

**D1Credentials** (`d1`)

To get all needed credentials from Cloudflare dashboard you need to

- Log in to the [Cloudflare dashboard](https://dash.cloudflare.com/login) and then:

To get `accountId`:
- Open "Workers & Pages" tab
- Go to "Overview" 
- Copy **Account ID** from the right sidebar

To get `databaseId`:
- Open D1 database you want to connect to and copy **Database ID** 

To get `token`:
- Open "My profile"
- Go to "API Tokens"
- Create token with D1 edit permissions

```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  dialect: "sqlite",
  driver: "d1-http",
  dbCredentials: {
    accountId: "",
    databaseId: "",
    token: "",
  }
})
```

### migrations

- **ç±»å‹**: `object`
- **å‘½ä»¤**: `migrate`

`migrations` å‚æ•°å…è®¸æ‚¨æŒ‡å®šè‡ªå®šä¹‰è¿ç§»çš„è¡¨å’Œæ¨¡å¼ï¼ˆä»…é€‚ç”¨äº PostgreSQLï¼‰ã€‚ 
é»˜è®¤æƒ…å†µä¸‹ï¼Œå…³äºå·²æ‰§è¡Œè¿ç§»çš„æ‰€æœ‰ä¿¡æ¯éƒ½å°†å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„
`__drizzle_migrations` è¡¨ä¸­ï¼Œå¹¶ä¸”å¯¹äº PostgreSQLï¼Œè¿˜å°†å­˜å‚¨åœ¨ drizzle æ¨¡å¼ä¸­ã€‚ 
ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥é…ç½®è®°å½•å­˜å‚¨åœ¨ä½•å¤„ã€‚

**ç”¨æ³•**
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  migrations: {
    table: "custom_migrations_table",
    schema: "public"
  }
});
```

### breakpoints

- **ç±»å‹**: `boolean`
- **ç¼ºçœå€¼**: `true`
- **å‘½ä»¤**: `generate`, `introspect`

`breakpoints` å‚æ•°å…è®¸æ‚¨åœ¨ç”Ÿæˆçš„è¿ç§»ä¸­å¯ç”¨/ç¦ç”¨ SQL è¯­å¥æ–­ç‚¹ã€‚å®ƒæ˜¯å¯é€‰çš„ï¼Œé»˜è®¤ä¸º `true`ï¼Œ
å®ƒå¯¹äºåœ¨ä¸æ”¯æŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„å¤šä¸ª DDL äº¤æ›¿è¯­å¥ï¼ˆMySQLã€SQLiteï¼‰çš„æ•°æ®åº“ä¸Šæ­£ç¡®åº”ç”¨è¿ç§»æ˜¯å¿…è¦çš„ï¼Œ
å› æ­¤ Drizzle ORM å¿…é¡»é€ä¸ªé¡ºåºåº”ç”¨å®ƒä»¬ã€‚
```sql {5}
CREATE TABLE `book` (
	`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	`name` text
);
--> statement-breakpoint
CREATE TABLE `book_to_author` (
	`author_id` integer,
	`book_id` integer,
	PRIMARY KEY(`book_id`, `author_id`)
);
```

**ç”¨æ³•**
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  breakpoints: true
});
```

### tablesFilters

- **ç±»å‹**: `string | string[]`
- **å‘½ä»¤**: `push`


`tablesFilter` å‚æ•°å…è®¸æ‚¨ä½¿ç”¨ç”¨äº db push å‘½ä»¤çš„ glob(opens in a new tab) è¯­æ³•è¿‡æ»¤è¡¨ã€‚
å½“æ‚¨åªæœ‰ä¸€ä¸ªæ•°æ®åº“å¯ç”¨äºå¤šä¸ªç‹¬ç«‹çš„å…·æœ‰å•ç‹¬çš„ SQL æ¨¡å¼çš„é¡¹ç›®æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚

å¦‚ä½•å®šä¹‰ä½¿ç”¨ Drizzle ORM çš„å¤šé¡¹ç›®è¡¨ â€” **[åœ¨æ­¤æŸ¥çœ‹ã€‚](/docs/goodies#multi-project-schema)**

**ç”¨æ³•**
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  tablesFilter: ["project1_*"],
});
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»…ä»¥ `project1_` å¼€å¤´çš„è¡¨å°†ä¸æ•°æ®åº“åŒæ­¥

### extensionsFilters

- **Type**: `string[]`
- **Commands**: `push`, `introspect`

<Callout>
Available from `drizzle-kit@0.22.0`
</Callout>

The PostGIS extension creates a few internal tables in the `public` schema. This means that if you have a database with the PostGIS extension and use `push` or `introspect`, all those tables will be included in `diff` operations. In this case, you would need to specify `tablesFilter`, find all tables created by the extension, and list them in this parameter.

We have addressed this issue so that you won't need to take all these steps. Simply specify `extensionsFilters` with the name of the extension used, and Drizzle will skip all the necessary tables.

Currently, we only support the `postgis` option, but we plan to add more extensions if they create tables in the `public` schema.

The `postgis` option will skip the `geography_columns`, `geometry_columns`, and `spatial_ref_sys` tables

**Usage**
```ts
import { defineConfig } from 'drizzle-kit'

export default defaultConfig({
  dialect: "postgresql",
  extensionsFilters: ["postgis"],
})
```

### schemaFilter

- **ç±»å‹**: `string | string[]`
- **ç¼ºçœå€¼**: `["public"]`
- **å‘½ä»¤**: `push`, `introspect`
- **å¯ç”¨æ•°æ®åº“**: `PostgreSQL`


`schemaFilter` å‚æ•°å…è®¸æ‚¨å®šä¹‰åœ¨ `introspect` 
æˆ– `push` å‘½ä»¤ä¸­åº”ä½¿ç”¨çš„ PostgreSQL æ¶æ„ã€‚
æ­¤å‚æ•°æ¥å—å•ä¸ªæ¨¡å¼ä½œä¸ºå­—ç¬¦ä¸²æˆ–ä½œä¸ºå­—ç¬¦ä¸²æ•°ç»„ã€‚æ­¤å¤„ä¸æ”¯æŒ glob æ¨¡å¼ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼Œdrizzle å°†åœ¨è¿™ä¸¤ä¸ªå‘½ä»¤ä¸­ä½¿ç”¨ `public` æ¶æ„ï¼Œä½†æ‚¨å¯ä»¥æ·»åŠ ä»»ä½•éœ€è¦çš„æ¨¡å¼ã€‚

ä¾‹å¦‚ï¼Œè®¾ç½® `schemaFilter: ["my_schema"]` å°†åªæŸ¥æ‰¾æ•°æ®åº“å’Œ 
drizzle æ¨¡å¼ä¸­å±äº `my_schema` æ¨¡å¼çš„è¡¨ã€‚

**ç”¨æ³•**
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  schemaFilter: ["public", "my_schema"],
});
```
### verbose

- **ç±»å‹**: `boolean`
- **ç¼ºçœå€¼**: false
- **å‘½ä»¤**: `push`

æ­¤å‘½ä»¤ç”¨äº `drizzle-kit push` å‘½ä»¤ï¼Œæ‰“å°å°†è¦æ‰§è¡Œçš„æ‰€æœ‰è¯­å¥ã€‚

<Callout>
    æ³¨æ„ï¼šæ­¤å‘½ä»¤åªä¼šæ‰“å°åº”è¯¥æ‰§è¡Œçš„è¯­å¥ã€‚
    è¦åœ¨åº”ç”¨ä¹‹å‰æ‰¹å‡†å®ƒä»¬ï¼Œè¯·å‚è€ƒ `strict` å‘½ä»¤ã€‚
</Callout>

**ç”¨æ³•**
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  verbose: true
});
```

### strict

- **ç±»å‹**: `boolean`
- **ç¼ºçœå€¼**: false
- **å‘½ä»¤**: `push`

æ­¤å‘½ä»¤ç”¨äº `drizzle-kit push` å‘½ä»¤ï¼Œå°†å§‹ç»ˆè¦æ±‚æ‚¨ç¡®è®¤æ˜¯å¦
è¦æ‰§è¡ŒåŒæ­¥æ¶æ„ä¸æ•°æ®åº“æ‰€éœ€çš„æ‰€æœ‰è¯­å¥ã€‚

**ç”¨æ³•**
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  strict: true
});
```

### introspect

- **ç±»å‹**: `object`

æ­¤éƒ¨åˆ†æ˜¯ `drizzle.config.*` æ–‡ä»¶ä¸­ `introspect` å¯¹è±¡çš„å‚è€ƒã€‚

#### casing

- **ç±»å‹**: `'preserve' | 'camel'`
- **ç¼ºçœå€¼**: `camel`
- **å‘½ä»¤**: 

æ­¤å‘½ä»¤è´Ÿè´£é€‰æ‹© introspect æ•°æ®åº“æ—¶çš„åˆ—ã€è¡¨ã€çº¦æŸ JS é”®åç§°çš„ç­–ç•¥ã€‚

**ç”¨æ³•**
```ts
import { defineConfig } from 'drizzle-kit'

export default defineConfig({
  introspect: {
    casing: 'preserve'
  }
});
```

**ç¤ºä¾‹**
<Tabs items={["preserve", "camel"]}>
<Tab>
```ts
export const user_preferences = sqliteTable(
  "user_preferences",
  {
    id: integer("id").primaryKey(),
    name: integer("name").notNull(),
    user_id: integer("user_id").notNull(),
  }
);
```
</Tab>
<Tab>
```ts
export const userPreferences = sqliteTable(
  "user_preferences",
  {
    id: integer("id").primaryKey(),
    name: integer("name").notNull(),
    userId: integer("user_id").notNull(),
  }
);
```
</Tab>
</Tabs>
