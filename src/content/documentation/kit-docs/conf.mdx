import CodeTab from "@/components/markdown/CodeTab.astro";
import CodeTabs from "@/components/markdown/CodeTabs.astro";
import Section from "@/components/markdown/Section.astro";
import Tab from "@/components/markdown/Tab.astro";
import Tabs from "@/components/markdown/Tabs.astro";
import Callout from "@/components/markdown/Callout.astro";

# é…ç½®æ–‡ä»¶
Drizzle Kit å…è®¸æ‚¨åœ¨ `TypeScript`ã€`JavaScript` æˆ– `JSON` é…ç½®æ–‡ä»¶ä¸­å£°æ˜é…ç½®ã€‚ 

æ‚¨å¯ä»¥æ‹¥æœ‰è‡ªåŠ¨è¡¥å…¨ä½“éªŒå’Œéå¸¸æ–¹ä¾¿çš„ç¯å¢ƒå˜é‡æµç¨‹ï¼ 

```plaintext {5}
ğŸ“¦ <project root>
 â”œ ...
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”œ ğŸ“œ drizzle.config.ts
 â”” ğŸ“œ package.json
```

<CodeTabs items={["drizzle.config.ts", "drizzle.config.js", "drizzle.config.json"]}>
<CodeTab>
```ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql", // "mysql" | "sqlite" | "postgresql"
  schema: "./src/schema.ts",
  out: "./drizzle",
});
```
</CodeTab>
<CodeTab>
```js
import type { Config } from "drizzle-kit";

/** @type { import("drizzle-kit").Config } */
export default {
  dialect: "postgresql", // "mysql" | "sqlite" | "postgresql"
  schema: "./src/schema.ts",
  out: "./drizzle",
};
```
</CodeTab>
<CodeTab>
```json
{
  "dialect": "postgresql",
  "schema": "./src/schema.ts",
  "out": "./drizzle",
}
```
</CodeTab>
</CodeTabs>

## æ¶æ„æ–‡ä»¶è·¯å¾„
`schema` å‚æ•°å…è®¸æ‚¨å®šä¹‰æ¶æ„æ–‡ä»¶çš„ä½ç½®ã€‚ 

æ‚¨å¯ä»¥æ‹¥æœ‰ä»»æ„æ•°é‡çš„ç‹¬ç«‹çš„æ¶æ„æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨**[`glob`](https://www.digitalocean.com/community/tools/glob?comments=true&glob=/**/*.js&matches=false&tests=//%20This%20will%20match%20as%20it%20ends%20with%20'.js'&tests=/hello/world.js&tests=//%20This%20won't%20match!&tests=/test/some/globs)**è¯­æ³•æˆ– glob æ•°ç»„è¯­æ³•å®šä¹‰è·¯å¾„ã€‚

<Tabs items={["ç¤ºä¾‹ 1", "ç¤ºä¾‹ 2", "ç¤ºä¾‹ 3"]}>
<Tab>
<Section>
```plaintext {7}
ğŸ“¦ <project root>
 â”œ ...
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”‚ â”œ ...
 â”‚ â”œ ğŸ“œ index.ts
 â”‚ â”” ğŸ“œ schema.ts 
 â”œ ğŸ“œ drizzle.config.ts
 â”” ğŸ“œ package.json
```
```ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  schema: "./src/schema.ts",
});
```
</Section>
</Tab>
<Tab>
<Section>
```plaintext {7,10}
ğŸ“¦ <project root>
 â”œ ...
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”‚ â”œ ğŸ“‚ user
 â”‚ â”‚ â”œ ğŸ“œ handler.ts 
 â”‚ â”‚ â”” ğŸ“œ schema.ts 
 â”‚ â”œ ğŸ“‚ posts
 â”‚ â”‚ â”œ ğŸ“œ handler.ts 
 â”‚ â”‚ â”” ğŸ“œ schema.ts 
 â”‚ â”” ğŸ“œ index.ts
 â”œ ğŸ“œ drizzle.config.ts
 â”” ğŸ“œ package.json
```
```ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  schema: "./src/**/schema.ts",
  //or
  schema: ["./src/user/schema.ts", "./src/posts/schema.ts"]
});
```
</Section>
</Tab>
<Tab>
<Section>
```plaintext {6-8}
ğŸ“¦ <project root>
 â”œ ...
 â”œ ğŸ“‚ drizzle
 â”œ ğŸ“‚ src
 â”‚ â”œ ğŸ“‚ schema
 â”‚ â”‚ â”œ ğŸ“œ user.ts 
 â”‚ â”‚ â”œ ğŸ“œ post.ts 
 â”‚ â”‚ â”” ğŸ“œ comment.ts 
 â”‚ â”” ğŸ“œ index.ts
 â”œ ğŸ“œ drizzle.config.ts
 â”” ğŸ“œ package.json
```
```ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  schema: "./src/schema/*",
});
```
</Section>
</Tab>
</Tabs>


## è¿ç§»æ–‡ä»¶å¤¹
`out` å‚æ•°å…è®¸æ‚¨å®šä¹‰è¿ç§»çš„æ–‡ä»¶å¤¹ï¼Œé»˜è®¤ä¸º `drizzle`ã€‚ 

éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºæ‚¨å¯ä»¥åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ä¸ºä¸åŒçš„æ•°æ®åº“æ‹¥æœ‰å¤šä¸ªç‹¬ç«‹çš„æ¶æ„ï¼Œå¹¶ä¸ºå®ƒä»¬å®šä¹‰ä¸åŒçš„è¿ç§»æ–‡ä»¶å¤¹ã€‚

è¿ç§»æ–‡ä»¶å¤¹åŒ…å« `.sql` è¿ç§»æ–‡ä»¶å’Œ `_meta` æ–‡ä»¶å¤¹ï¼Œç”± `drizzle-kit` ä½¿ç”¨ã€‚
<Callout type="warning" emoji="âš ï¸">
è¯·å‹¿æ‰‹åŠ¨åˆ é™¤ä»»ä½•æ–‡ä»¶ï¼Œè¯·å‚è€ƒ [`drizzle-kit drop`](/kit-docs/commands#drop-migration) å‘½ä»¤
</Callout>

<Section>
```plaintext {3}
ğŸ“¦ <project root>
 â”œ ...
 â”œ ğŸ“‚ drizzle
 â”‚ â”œ ğŸ“‚ _meta
 â”‚ â”œ ğŸ“œ user.ts 
 â”‚ â”œ ğŸ“œ post.ts 
 â”‚ â”” ğŸ“œ comment.ts 
 â”œ ğŸ“‚ src
 â”œ ğŸ“œ drizzle.config.ts
 â”” ğŸ“œ package.json
```
```ts {5}
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql", // "mysql" | "sqlite" | "postgresql"
  schema: "./src/schema/*",
  out: "./drizzle",
});
```
</Section>

## SQL æ–­ç‚¹
`breakpoints` å‚æ•°å…è®¸æ‚¨åœ¨ç”Ÿæˆçš„è¿ç§»ä¸­å¯ç”¨/ç¦ç”¨ SQL è¯­å¥æ–­ç‚¹ã€‚

å®ƒæ˜¯å¯é€‰çš„ï¼Œé»˜è®¤ä¸º `true`ï¼Œ 
å®ƒå¯¹äºåœ¨ä¸æ”¯æŒä¸€æ¬¡äº‹åŠ¡ä¸­çš„å¤šä¸ª DDL å˜æ›´è¯­å¥çš„æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼ŒSQLiteï¼‰ä¸Šæ­£ç¡®åº”ç”¨è¿ç§»æ˜¯å¿…è¦çš„ï¼Œ
Drizzle ORM å¿…é¡»æŒ‰é¡ºåºé€ä¸ªåº”ç”¨å®ƒä»¬ã€‚
```sql {5}
CREATE TABLE `book` (
	`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	`name` text
);
--> statement-breakpoint
CREATE TABLE `book_to_author` (
	`author_id` integer,
	`book_id` integer,
	PRIMARY KEY(`book_id`, `author_id`)
);
```
## æ¨é€å’Œæ‹‰å–
Drizzle Kit æä¾›äº† **[introspect](/kit-docs/commands#introspect--pull)** å’Œ **[push](/kit-docs/commands#prototype--push)** APIã€‚

æˆ‘ä»¬é•œåƒäº†æ•°æ®åº“é©±åŠ¨ç¨‹åºçš„è¿æ¥å‚æ•°ã€‚

<Tabs items={["è¿æ¥ URI", "è¿æ¥å‚æ•°"]}>
<Tab>
```ts {8}
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql", // "mysql" | "sqlite" | "postgresql"
  schema: "./src/schema/*",
  out: "./drizzle",
  dbCredentials: {
    url: process.env.DB_URL,
  }
});
```
<Callout type="info" emoji="â„¹ï¸">
ä½¿ç”¨ PlanetScale é©±åŠ¨ç¨‹åºæ—¶ï¼Œæ‚¨çš„è¿æ¥å­—ç¬¦ä¸²å¿…é¡»ä»¥ `?ssl={"rejectUnauthorized":true}` ç»“å°¾ï¼Œè€Œä¸æ˜¯ `?sslaccept=strict`ã€‚
</Callout>

</Tab>
<Tab>
```ts {10-14}
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  schema: "./src/schema/*",
  out: "./drizzle",
  dialect: "postgresql", // "mysql" | "sqlite" | "postgresql"
  dbCredentials: {
    user: "postgres",
    password: process.env.DATABASE_PASSWORD,
    host: "127.0.0.1",
    port: 5432,
    database: "db",
  }
});
```
</Tab>
</Tabs>

## å¤šé¡¹ç›®æ¶æ„
`tablesFilter` å‚æ•°å¯¹äº db **[`push`](/kit-docs/commands#prototype--push)** å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ **[`glob`](https://www.digitalocean.com/community/tools/glob?comments=true&glob=/**/*.js&matches=false&tests=//%20This%20will%20match%20as%20it%20ends%20with%20'.js'&tests=/hello/world.js&tests=//%20This%20won't%20match!&tests=/test/some/globs)** è¯­æ³•æ¥è¿‡æ»¤è¡¨ã€‚å½“æ‚¨åªæœ‰ä¸€ä¸ªæ•°æ®åº“å¯ç”¨äºå¤šä¸ªå…·æœ‰ç‹¬ç«‹ SQL æ¶æ„çš„åˆ†ç¦»é¡¹ç›®æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚ 

å¦‚ä½•ä½¿ç”¨ Drizzle ORM å®šä¹‰å¤šé¡¹ç›®è¡¨ â€” è¯·å‚é˜… **[è¿™é‡Œã€‚](/docs/goodies#multi-project-schema)**

<Section>
```ts {3}
import { serial, text, pgTableCreator } from 'drizzle-orm/pg-core';

const pgTable = pgTableCreator((name) => `project1_${name}`);

const users = pgTable('users', {
  id: serial('id').primaryKey(),
  name: text('name').notNull(),
});
```
```ts {7}
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  schema: "./src/schema/*",
  out: "./drizzle",
  dialect: "mysql", // "mysql" | "sqlite" | "postgresql"
  dbCredentials: {
    url: process.env.DATABASE_URL,
  }
  tablesFilter: ["project1_*"],
});
```
</Section>

æ‚¨å¯ä»¥åº”ç”¨å¤šä¸ª `or` è¿‡æ»¤å™¨ï¼š
```ts
tablesFilter: ["project1_*", "project2_*"]
```
