---
title: DrizzleORM v0.29.4 å‘å¸ƒ
pubDate: 2024-02-22
description: æ·»åŠ äº† Neon HTTP Batch æ”¯æŒï¼Œå¹¶æ›´æ–°äº† database-js çš„é»˜è®¤è¡Œä¸ºå’Œå®ä¾‹ã€‚
---
import Section from "@mdx/Section.astro";

## æ–°ç‰¹æ€§

### ğŸ‰ Neon HTTP Batch

æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ [Neon æ–‡æ¡£](https://neon.tech/docs/serverless/serverless-driver#issue-multiple-queries-with-the-transaction-function) å’Œ [Neon å’Œ Drizzle å…¥é—¨æŒ‡å—](https://orm.drizzle.team/docs/get-started-postgresql#neon).

<Section>
```ts copy {8}
import { neon } from '@neondatabase/serverless';
import { drizzle } from 'drizzle-orm/neon-http';
import { usersTable } from './schema';

const sql = neon(process.env.DRIZZLE_DATABASE_URL!);
const db = drizzle(sql);

const batchResponse: BatchType = await db.batch([
	db.insert(usersTable).values({ id: 1, name: 'John' }).returning({
		id: usersTable.id,
	}),
	db.insert(usersTable).values({ id: 2, name: 'Dan' }),
	db.query.usersTable.findMany({}),
	db.query.usersTable.findFirst({}),
]);
```

```ts
type BatchType = [
	{
		id: number;
	}[],
	NeonHttpQueryResult<never>,
	{
		id: number;
		name: string;
		verified: number;
		invitedBy: number | null;
	}[],
	{
		id: number;
		name: string;
		verified: number;
		invitedBy: number | null;
	} | undefined,
];
```
</Section>

## æ”¹è¿›

æ„Ÿè°¢ `database-js` å’Œ `PlanetScale` å›¢é˜Ÿçš„å¸®åŠ©ï¼Œæˆ‘ä»¬å·²ç»æ›´æ–°äº† `database-js` çš„é»˜è®¤è¡Œä¸ºå’Œå®ä¾‹ã€‚

æ ¹æ® `database-js` æ ¸å¿ƒå›¢é˜Ÿçš„å»ºè®®ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨ `Client` å®ä¾‹è€Œä¸æ˜¯ `connect()`ï¼š

```ts copy {1,5}
import { Client } from '@planetscale/database';
import { drizzle } from 'drizzle-orm/planetscale-serverless';

// åˆ›å»ºè¿æ¥
const client = new Client({
	host: process.env['DATABASE_HOST'],
	username: process.env['DATABASE_USERNAME'],
	password: process.env['DATABASE_PASSWORD'],
});

const db = drizzle(client);
```

> è­¦å‘Šï¼šåœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰ç ´åæ€§æ›´æ”¹ï¼Œä½†ä»ç‰ˆæœ¬ `0.30.0` å¼€å§‹ï¼Œå¦‚æœå°è¯•ä½¿ç”¨é™¤ `Client` å®ä¾‹ä»¥å¤–çš„ä»»ä½•å†…å®¹ï¼Œå°†é‡åˆ°é”™è¯¯ã€‚
>
> æˆ‘ä»¬å»ºè®®å¼€å§‹æ›´æ”¹è¿æ¥åˆ° PlanetScaleï¼Œä»¥é˜²æ­¢å°†æ¥å‡ºç°ä»»ä½•è¿è¡Œæ—¶é”™è¯¯ã€‚

ä»¥å‰æˆ‘ä»¬çš„æ–‡æ¡£ä¸­æŒ‡å‡ºè¦ä½¿ç”¨ `connect()`ï¼Œå¹¶ä¸”åªæœ‰è¿™ä¸ªå‡½æ•°å¯ä»¥ä¼ é€’ç»™ drizzleã€‚åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†å¯¹ `new Client()` çš„æ”¯æŒï¼Œå¹¶å¼ƒç”¨äº† `connect()`ï¼Œå»ºè®®æ¥è‡ª `database-js` å›¢é˜Ÿã€‚åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œå½“å°è¯•ä¼ é€’ `connect()` å‡½æ•°ç»“æœæ—¶ï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ª `è­¦å‘Š`ï¼š

**è­¦å‘Šæ–‡æœ¬**

```mdx
è­¦å‘Šï¼šæ‚¨éœ€è¦ä¼ é€’ Client å®ä¾‹ï¼š

import { Client } from "@planetscale/database";

const client = new Client({
  host: process.env["DATABASE_HOST"],
  username: process.env["DATABASE_USERNAME"],
  password: process.env["DATABASE_PASSWORD"],
});

const db = drizzle(client);

ä»ç‰ˆæœ¬ 0.30.0 å¼€å§‹ï¼Œå¦‚æœå°è¯•ä½¿ç”¨é™¤ Client å®ä¾‹ä»¥å¤–çš„ä»»ä½•å†…å®¹ï¼Œå°†é‡åˆ°é”™è¯¯ã€‚

è¯·ç«‹å³è¿›è¡Œå¿…è¦çš„æ›´æ”¹ï¼Œä»¥é˜²æ­¢å°†æ¥å‡ºç°ä»»ä½•è¿è¡Œæ—¶é”™è¯¯ã€‚
```
