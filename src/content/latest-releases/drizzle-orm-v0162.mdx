---
title: DrizzleORM v0.16.2 å‘å¸ƒ
pubDate: 2023-01-21
description: Drizzle ORM - æ˜¯ä¸€ç§è¯­ä¹‰åŒ–çš„ TypeScript ORMï¼Œå¯ç”¨ä½œæŸ¥è¯¢æ„å»ºå™¨å’Œä½œä¸º SQL æ¨¡å¼çš„çœŸå®æºå’Œç”¨äºè‡ªåŠ¨ç”Ÿæˆè¿ç§»çš„ CLIã€‚
---
import Section from "@mdx/Section.astro";

Drizzle ORM - æ˜¯ä¸€ç§è¯­ä¹‰åŒ–çš„ TypeScript ORMï¼Œå¯ç”¨ä½œæŸ¥è¯¢æ„å»ºå™¨å’Œä½œä¸º SQL æ¨¡å¼çš„çœŸå®æºå’Œç”¨äºè‡ªåŠ¨ç”Ÿæˆè¿ç§»çš„ CLIã€‚

è‡ªä¸Šä¸€æ¬¡çš„ä¸»è¦æ›´æ–°ä»¥æ¥ï¼Œæˆ‘ä»¬å·²ç»æ·»åŠ äº†è®¸å¤šè¢«è¯·æ±‚çš„åŠŸèƒ½ ğŸš€

### ğŸ‰ PostgreSQL schemas

æ‚¨ç°åœ¨å¯ä»¥å£°æ˜è¦åœ¨æ­¤æ¶æ„ä¸­åˆ›å»ºçš„ [PostgreSQL schemas](https://www.postgresql.org/docs/current/ddl-schemas.html) å’Œè¡¨

<Section>
```ts copy
// src/schema.ts
import { pgSchema } from "drizzle-orm-pg";

export const mySchema = pgSchema("my_schema");

export const users = mySchema("users", {
  id: serial("id").primaryKey(),
  name: text("name"),
  email: text("email"),
});
```
```sql
CREATE SCHEMA "my_schema";

CREATE TABLE IF NOT EXISTS "my_schema"."users" (
	"id" serial PRIMARY KEY NOT NULL,
	"name" text,
	"email" text
);
```
</Section>

[drizzle-kit](https://driz.link/kit) å°†è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰éœ€è¦çš„ SQL è¿ç§»

 ```shell 
drizzle-kit generate:pg --schema=src/schema.ts --out=migrations/ 
 ```

### ğŸ‰ MySQL databases/schemas

æ‚¨ç°åœ¨å¯ä»¥å£°æ˜è¦åœ¨æ­¤ä¸­åˆ›å»ºçš„ [MySQL æ•°æ®åº“/æ¨¡å¼](https://dev.mysql.com/doc/refman/8.0/en/create-database.html) å’Œè¡¨

```ts copy
// schema.ts
import { mysqlSchema } from "drizzle-orm-mysql";

const mySchema = mysqlSchema("my_schema");

const users = mySchema("users", {
  id: serial("id").primaryKey(),
  name: text("name"),
  email: text("email"),
});
```

[drizzle-kit](https://driz.link/kit) å°†è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰éœ€è¦çš„ SQL è¿ç§» ```shell drizzle-kit
generate:mysql --schema=src/schema.ts --out=migrations/ ```

è¿™å°†è‡ªåŠ¨ç”Ÿæˆ SQL è¿ç§»

```sql
CREATE DATABASE `my_schema`;

CREATE TABLE `my_schema`.`users` (
	`id` serial PRIMARY KEY NOT NULL,
	`name` text,
	`email` text
);
```

### ğŸ‰ PostgreSQL introspect

æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨ [drizzle-kit](https://driz.link/kit) åœ¨å‡ ç§’é’Ÿå†…ä»ç°æœ‰çš„ PostgreSQL æ•°æ®åº“ä¸­æå–æ•°æ®åº“æ¨¡å¼ï¼Œæ— éœ€åˆ‡æ¢ä»»ä½•ç°æœ‰çš„ ORM æˆ–åŸå§‹ SQLã€‚å®ƒæ”¯æŒï¼š

- æšä¸¾
- å…·æœ‰æ‰€æœ‰æœ¬åœ°å’Œéæœ¬åœ°åˆ—çš„è¡¨
- ç´¢å¼•
- å¤–é”®ã€è‡ªå¼•ç”¨å’Œå¾ªç¯å¤–é”®
- æ¨¡å¼

```shell
drizzle-kit introspect:pg --out=migrations/ --connectionString=postgresql://user:pass@host:port/db_name
```

å®ƒå°†ä¸ºæ‚¨æ‰“å° `schema.ts`

```ts copy
export const myEnum = pgEnum("my_enum", ["one", "two", "three"]);
export const mySchema = pgSchema("my_schema");

export const users = mySchema("users", {
  id: serial("id").primaryKey(),
  name: text("name"),
  email: text("email"),
});

export const users2 = pgTable("users2", {
  id: serial("id").primaryKey(),
  name: varchar("name2"),
  enum: myEnum("enum"),
});

export const allColumns = pgTable("all_columns", {
  sm: smallint("smallint"),
  smdef: smallint("smallint_def").default(10),
  int: integer("integer"),
  intdef: integer("integer_def").default(10),
  numeric: numeric("numeric"),
  numeric2: numeric("numeric2", { precision: 7 }),
  numeric3: numeric("numeric3", { scale: 7 }),
  numeric4: numeric("numeric4", { precision: 7, scale: 7 }),
  numericdef: numeric("numeridef").default("100"),
  bigint: bigint("bigint", { mode: "number" }),
  bigintdef: bigint("bigint", { mode: "number" }).default(100),
  bool: boolean("boolean"),
  booldef: boolean("boolean_def").default(true),
  text: text("text"),
  textdef: text("textdef").default("text"),
  varchar: varchar("varchar"),
  varchardef: varchar("varchardef").default("text"),
  serial: serial("serial"),
  bigserial: bigserial("bigserial", { mode: "bigint" }),
  decimal: decimal("decimal", { precision: 100, scale: 2 }),
  decimaldef: decimal("decimaldef", { precision: 100, scale: 2 }).default(
    "100.0",
  ),
  doublePrecision: doublePrecision("decimal"),
  doublePrecisiondef: doublePrecision("decimaldef").default(100.0),
  real: real("real"),
  realdef: real("decimaldef").default(100.0),
  json: json<{ attr: string }>("json"),
  jsondef: json<{ attr: string }>("jsondef").default({ attr: "value" }),
  jsonb: jsonb<{ attr: string }>("jsonb"),
  jsonbdef: jsonb<{ attr: string }>("jsonbdef").default({ attr: "value" }),
  time: time("time"),
  time2: time("time2", { precision: 6, withTimezone: true }),
  timedefnow: time("timedefnow").defaultNow(),
  timestamp: timestamp("timestamp"),
  timestamp2: timestamp("timestamp2", { precision: 6, withTimezone: true }),
  timestamp3: timestamp("timestamp3", { withTimezone: true }),
  timestamp4: timestamp("timestamp4", { precision: 4 }),
  timestampdef: timestamp("timestampdef").defaultNow(),
  date: date("date", { mode: "date" }),
  datedef: date("datedef").defaultNow(),
  interval: interval("interval"),
  intervaldef: interval("intervaldef").default("10 days"),
});

export const cyclic1 = pgTable("cyclic1", {
  id: serial("id").primaryKey(),
  ext2: integer("ext2").references(() => cyclic2.id),
});

export const cyclic2 = pgTable("cyclic2", {
  id: serial("id").primaryKey(),
  ext1: integer("ext1").references((): AnyPgColumn => cyclic1.id),
});

export const example = pgTable(
  "example",
  {
    id: serial("id").primaryKey(),
    reportsTo: integer("reports_to"),
  },
  (table) => {
    return {
      reportsToFK: foreignKey({
        columns: [table.reportsTo],
        foreignColumns: [table.id],
      }),
    };
  },
);
```

### ğŸ‰ Postgres.js é©±åŠ¨æ”¯æŒ

æˆ‘ä»¬å®Œå…¨æ”¯æŒäº† [postgres.js](https://github.com/porsager/postgres)ï¼Œå®ƒè½»é‡ä¸”é€Ÿåº¦å¿« ğŸš€

```ts copy
// schema.ts
import { pgTable, serial, text, varchar } from "drizzle-orm-pg";
export const users = pgTable("users", {
  id: serial("id").primaryKey(),
  fullName: text("full_name"),
  phone: varchar("phone", { length: 256 }),
});

// index.ts
import { drizzle, PostgresJsDatabase } from "drizzle-orm-pg/postgres.js";
import postgres from "postgres";
import { users } from "./schema";

const client = postgres(connectionString);
const db: PostgresJsDatabase = drizzle(client);

const allUsers = await db.select(users);
```

å®Œæ•´çš„ PostgreSQL æ–‡æ¡£è¯·å‚è§ [è¿™é‡Œ](https://github.com/drizzle-team/drizzle-orm/tree/main/drizzle-orm-pg)

### ğŸ‰ PostgreSQL å’Œ MySQL ç±»å‹

æˆ‘ä»¬ä¸ºæ‚¨æä¾›äº†ä¸€äº›æœ‰ç”¨çš„æ“ä½œç¬¦ï¼Œç”¨äºåˆ›å»ºæ‰€éœ€çš„éæœ¬åœ° PostgreSQL æˆ– MySQL ç±»å‹

```ts copy
// PostgreSQL
const customText = customType<{ data: string }>({
  dataType() {
    return "text";
  },
});

const usersTable = pgTable("users", {
  name: customText("name").notNull(),
});

// MySQL
const customText = customType<{ data: string }>({
  dataType() {
    return "text";
  },
});

const usersTable = mysqlTable("users", {
  name: customText("name").notNull(),
});
```
