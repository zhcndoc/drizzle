---
title: DrizzleORM v0.28.6 å‘å¸ƒ
pubDate: 2023-09-06
description: ä¿®æ”¹äº† MySQL çš„ datetime æ˜ å°„ï¼Œå¢åŠ äº† LibSQL æ‰¹å¤„ç† API æ”¯æŒï¼Œä¸º SQLite ä¸­çš„æ–‡æœ¬æ·»åŠ äº† JSON æ¨¡å¼ï¼Œä¸ºå…³ç³»æŸ¥è¯¢ API è°ƒç”¨æ·»åŠ äº† '.toSQL()'ï¼Œä¸ºæ•°ç»„æ·»åŠ äº†æ–°çš„ PostgreSQL æ“ä½œç¬¦ï¼Œåœ¨å…³ç³»æŸ¥è¯¢ä¸­ä¸º 'where' å‡½æ•°æ·»åŠ äº†æ›´å¤šçš„ SQL æ“ä½œç¬¦ï¼Œå¹¶ä¿®å¤äº†ä¸€äº›é”™è¯¯ã€‚
---
import Section from "@mdx/Section.astro";

## ä¿®æ”¹

> **æ³¨æ„**ï¼š
> MySQL ä½¿ç”¨ `mode: 'date'` å­˜å‚¨æ—¥æœŸæ—¶å°†ä»¥UTCå­—ç¬¦ä¸²å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ï¼Œä»¥ä¾¿ä¸ MySQL çš„ `datetime` è¡Œä¸ºä¿æŒä¸€è‡´ã€‚å¦‚æœéœ€è¦ä¸åŒçš„è¡Œä¸ºå¹¶å¸Œæœ›ä»¥ä¸åŒçš„æ–¹å¼å¤„ç† `datetime` æ˜ å°„ï¼Œè¯·ä½¿ç”¨ `mode: 'string'` æˆ–[è‡ªå®šä¹‰ç±»å‹](https://orm.drizzle.team/docs/custom-types)å®ç°

æœ‰å…³å®ç°ç»†èŠ‚ï¼Œè¯·å‚è§[ä¿®å¤ MySQL çš„ Datetime æ˜ å°„](https://github.com/drizzle-team/drizzle-orm/pull/1082)

## æ–°åŠŸèƒ½

### ğŸ‰ `LibSQL` æ‰¹å¤„ç† API æ”¯æŒ

å‚è€ƒï¼šhttps://docs.turso.tech/reference/client-access/javascript-typescript-sdk#execute-a-batch-of-statements

æ‰¹å¤„ç† API ä½¿ç”¨ç¤ºä¾‹:

<Section>
```ts copy {1}
const batchResponse = await db.batch([
	db.insert(usersTable).values({ id: 1, name: 'John' }).returning({
		id: usersTable.id,
	}),
	db.update(usersTable).set({ name: 'Dan' }).where(eq(usersTable.id, 1)),
	db.query.usersTable.findMany({}),
	db.select().from(usersTable).where(eq(usersTable.id, 1)),
	db.select({ id: usersTable.id, invitedBy: usersTable.invitedBy }).from(
		usersTable,
	),
]);
```

```ts
type BatchResponse = [
	{
		id: number;
	}[],
	ResultSet,
	{
		id: number;
		name: string;
		verified: number;
		invitedBy: number | null;
	}[],
	{
		id: number;
		name: string;
		verified: number;
		invitedBy: number | null;
	}[],
	{
		id: number;
		invitedBy: number | null;
	}[],
];
```
</Section>

å¯ä»¥åœ¨ `db.batch` ä¸­ä½¿ç”¨çš„æ‰€æœ‰å¯èƒ½çš„æ„å»ºå™¨ï¼š

```ts
`db.all()`,
`db.get()`,
`db.values()`,
`db.run()`,
`db.query.<table>.findMany()`,
`db.query.<table>.findFirst()`,
`db.select()...`,
`db.update()...`,
`db.delete()...`,
`db.insert()...`,
```

æ›´å¤šä½¿ç”¨ç¤ºä¾‹è¯·å‚è§ï¼š[integration-tests/tests/libsql-batch.test.ts](https://github.com/drizzle-team/drizzle-orm/pull/1161/files#diff-17253895532e520545027dd48dcdbac2d69a5a49d594974e6d55d7502f89b838R248) å’Œ[æ–‡æ¡£](https://orm.drizzle.team/docs/batch-api)

### ğŸ‰ ä¸º SQLite çš„æ–‡æœ¬æ·»åŠ  JSON æ¨¡å¼

åœ¨[æ–‡æ¡£](https://orm.drizzle.team/docs/get-started-postgresql#http-proxy)ä¸­äº†è§£æ›´å¤šä¿¡æ¯

```ts copy {2}
const test = sqliteTable('test', {
	dataTyped: text('data_typed', { mode: 'json' }).$type<{ a: 1 }>().notNull(),
});
```

### ğŸ‰ åœ¨å…³ç³»æŸ¥è¯¢ API è°ƒç”¨ä¸­å¢åŠ `.toSQL()`

```ts copy {1}
const query = db.query.usersTable.findFirst().toSQL();
```

### ğŸ‰ ä¸º Arrays æ·»åŠ æ–°çš„ PostgreSQL æ“ä½œç¬¦

æ“ä½œç¬¦åˆ—è¡¨å’Œä½¿ç”¨ç¤ºä¾‹
`arrayContains`ï¼Œ`arrayContained`ï¼Œ`arrayOverlaps`

åœ¨[æ–‡æ¡£](https://orm.drizzle.team/docs/get-started-postgresql#http-proxy)ä¸­äº†è§£æ›´å¤šä¿¡æ¯

```ts copy {2,5,8,11,12,13,14}
const contains = await db.select({ id: posts.id }).from(posts)
	.where(arrayContains(posts.tags, ['Typescript', 'ORM']));

const contained = await db.select({ id: posts.id }).from(posts)
	.where(arrayContained(posts.tags, ['Typescript', 'ORM']));

const overlaps = await db.select({ id: posts.id }).from(posts)
	.where(arrayOverlaps(posts.tags, ['Typescript', 'ORM']));

const withSubQuery = await db.select({ id: posts.id }).from(posts)
	.where(arrayContains(
		posts.tags,
		db.select({ tags: posts.tags }).from(posts).where(eq(posts.id, 1)),
	));
```

### ğŸ‰ åœ¨å…³ç³»æŸ¥è¯¢çš„ where è¿‡æ»¤å™¨å‡½æ•°ä¸­å¢åŠ æ›´å¤š SQL æ“ä½œç¬¦

åœ¨[æ–‡æ¡£](https://orm.drizzle.team/docs/rqb#select-filters)ä¸­å¯ä»¥æ‰¾åˆ°æ›´å¤šç¤ºä¾‹

<Section>
```ts
// Before
import { inArray } from "drizzle-orm/pg-core";

await db.users.findFirst({
  where: (table, _) => inArray(table.id, [ ... ])
})
```

```ts copy {3}
// After
await db.users.findFirst({
  where: (table, { inArray }) => inArray(table.id, [ ... ])
})
```
</Section>

## ä¿®å¤

- åœ¨ SQLite ä¸­æ­£ç¡®å¤„ç†å†²çªä½ç½®ï¼ˆ[#1076](https://github.com/drizzle-team/drizzle-orm/pull/1076)ï¼‰
- ä¿®æ­£äº† libsql/client ç±»å‹å¯¼å…¥ï¼ˆ[#1122](https://github.com/drizzle-team/drizzle-orm/pull/1122)ï¼‰
- ä¿®å¤äº†åœ¨ RDS ä¸Šä¸æ­£ç¡®æ˜ å°„åŸå§‹ SQL æŸ¥è¯¢çš„é—®é¢˜ï¼ˆ[#1071](https://github.com/drizzle-team/drizzle-orm/pull/1071)ï¼‰
- ä¿®å¤äº† MySQL çš„ Datetime æ˜ å°„ï¼ˆ[#1082](https://github.com/drizzle-team/drizzle-orm/pull/1082)ï¼‰
- ä¿®å¤äº† smallserial ç”Ÿæˆä¸º serial çš„é—®é¢˜ï¼ˆ[#1127](https://github.com/drizzle-team/drizzle-orm/pull/1127)ï¼‰
