---
import { Image } from "astro:assets";
import { type IComment } from "./Comments";

interface Props {
  twit: IComment;
}

const { twit } = Astro.props;

const { text } = twit;
const formattedText = text ? text.replaceAll(/@\w+/gi, "<span class='mention'>$&</span>") : null;
---

<div class="wrap">
  <div class="top">
    <div class="avatar_wrapper">
      <Image class="avatar" src={twit.avatar} alt={twit.login} />
    </div>
    <div class="name_wrapper">
      <div class="name">{twit.name}</div>
      <div class="login">@{twit.login}</div>
    </div>
  </div>
  <div class="content">
    {formattedText && (
      <div class="twit_content_text"><Fragment set:html={formattedText} /></div>
    )}
    {
      twit.twitImage && (
        <Image class="content_image" width={560} src={twit.twitImage} alt={twit.name} />
      )
    }
  </div>
</div>
<style>
  html[class~="dark"] .wrap {
    border: 1px solid rgb(64, 64, 64);
    background-color: #282828;
    color: rgb(226, 232, 240);
  }

  html[class~="dark"] .login {
    color: #a4b7d0;
  }

  .wrap {
    display: flex;
    flex-direction: column;
    border-radius: 12px;
    padding: 16px;
    border: 1px solid #e8e8e8;
    color: #282b3b;
    background-color: #ffffff;
    gap: 20px;
    break-inside: avoid;
    margin-bottom: 20px;
  }

  .top {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 12px;
  }

  .avatar_wrapper {
    width: 100%;
    max-width: 48px;
    height: 48px;
  }

  .avatar {
    width: 100%;
    height: 100%;
    border-radius: 50%;
  }

  .name_wrapper {
    font-size: 14px;
  }

  .name {
    font-weight: 700;
  }

  .login {
    font-weight: 400;
    color: #71767b;
  }

  .content {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .twit_content_text {
    font-size: 16px;
    white-space: pre-wrap;
  }

  html.dark .content_image {
    border: 1px solid rgb(47, 51, 54);
  }
  
  .content_image {
    border-radius: 8px;
    border: 1px solid rgb(207, 217, 222);
    max-height: 180px;
    object-fit: cover;
  }

  @media (max-width: 599px) {
    .wrap {
      width: 314px;
      border-radius: 5px;
      margin-bottom: 10px;
    }
  }
</style>
<style is:global>
  .twit_content_text .mention {
    color: rgb(0, 107, 230);
  }
</style>
